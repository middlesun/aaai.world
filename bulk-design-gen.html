<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Design Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colors */
            --color-black-gradient-start: #000000;
            --color-black-gradient-end: #0a0a0b;
            --color-jetblack-gradient: linear-gradient(to bottom, var(--color-black-gradient-start), var(--color-black-gradient-end));
            --color-glass-background: rgba(28, 28, 30, 0.82);
            --color-glass-border: rgba(255, 255, 255, 0.08);
            --color-purple: #8353da;
            --color-purple-hover: #9567e4;
            --color-purple-active: #6f41c3;
            
            /* Shadows */
            --shadow-base: 0 1px 4px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 4px 12px rgba(131, 83, 218, 0.15);
            
            /* Blur & Effects */
            --blur-glass: blur(24px);
            --grain-opacity: 0.03;
            
            /* Typography */
            --font-inter: 'Inter', sans-serif;
            --font-code: 'Fira Code', 'SF Mono', monospace;
            --font-size-body: 15px;
            --font-size-body-max: 17px;
            --font-size-ui: 14px;
            --font-size-headline-min: 20px;
            --font-size-headline-max: 28px;
            --font-weight-regular: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --line-height-body: 1.6;
            --line-height-headline: 1.3;
            --letter-spacing-ui: 0.1px;
            
            /* Border Radius */
            --radius-base: 8px;
            
            /* Legacy compatibility */
            --aurora-cyan: var(--color-purple);
            --aurora-purple: var(--color-purple);
            --aurora-pink: var(--color-purple);
            --glass-bg: var(--color-glass-background);
            --glass-border: var(--color-glass-border);
            --glass-shadow: var(--shadow-base);
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.75);
            --text-muted: rgba(255, 255, 255, 0.55);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-inter);
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            margin: 0;
            padding: 0;
            background: var(--color-jetblack-gradient);
            position: relative;
            overflow-x: hidden;
            color: var(--text-primary);
        }

        /* Aurora Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, var(--aurora-cyan), var(--aurora-purple), var(--aurora-pink), var(--aurora-cyan));
            background-size: 400% 400%;
            animation: aurora 8s ease-in-out infinite;
            opacity: 0.15;
            z-index: -1;
        }

        @keyframes aurora {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--text-primary);
        }

        .heading-lg { font-size: 36px; line-height: 44px; }
        .heading-md { font-size: 28px; line-height: 36px; }
        .heading-sm { font-size: 20px; line-height: 28px; }

        .mono { 
            font-family: 'Roboto Mono', monospace; 
            font-weight: 400;
        }

        /* Glass Components - New Design System */
        .glass-card {
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--radius-base);
            box-shadow: var(--shadow-base);
            transition: all 0.25s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .glass-card:active {
            transform: scale(0.98);
        }

        /* Form Controls - New Design System */
        .aurora-input {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: var(--blur-glass);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-base);
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: var(--font-inter);
            font-size: var(--font-size-body);
            transition: all 0.25s ease-in-out;
            outline: none;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .aurora-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .aurora-input:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .aurora-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--color-purple);
            box-shadow: var(--shadow-base), var(--shadow-glow), inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .aurora-select {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: var(--blur-glass);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-base);
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: var(--font-inter);
            font-size: var(--font-size-body);
            transition: all 0.25s ease-in-out;
            outline: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%238353da' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            appearance: none;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .aurora-select:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .aurora-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--color-purple);
            box-shadow: var(--shadow-base), var(--shadow-glow), inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .aurora-select option {
            background: var(--color-black-gradient-start);
            color: var(--text-primary);
        }

        /* Primary Button - New Design System */
        .aurora-button {
            background-color: var(--color-purple);
            border: none;
            border-radius: var(--radius-base);
            padding: 14px 24px;
            color: white;
            font-family: var(--font-inter);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-ui);
            letter-spacing: var(--letter-spacing-ui);
            transition: all 0.25s ease-in-out;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-base);
            cursor: pointer;
        }

        .aurora-button:hover {
            background-color: var(--color-purple-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .aurora-button:active {
            background-color: var(--color-purple-active);
            transform: scale(0.98);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .aurora-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .aurora-button.generating {
            animation: buttonPulse 2s ease-in-out infinite;
        }

        @keyframes buttonPulse {
            0%, 100% { 
                box-shadow: var(--shadow-base);
            }
            50% { 
                box-shadow: var(--shadow-base), var(--shadow-glow);
            }
        }

        /* Glass Secondary Button - New Design System */
        .glass-button {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: var(--blur-glass);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: var(--radius-base);
            padding: 10px 16px;
            color: var(--text-primary);
            font-family: var(--font-inter);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-ui);
            letter-spacing: var(--letter-spacing-ui);
            transition: all 0.25s ease-in-out;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .glass-button:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05), 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Active button states */
        .glass-button.active {
            background-color: var(--color-purple);
            color: white;
            font-weight: var(--font-weight-medium);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .glass-button.active:hover {
            background-color: var(--color-purple-hover);
            transform: translateY(-1px);
        }

        /* Draggable Creativity Slider - New Design System */
        .creativity-slider-container {
            padding: 12px 0;
        }

        .creativity-slider-track {
            position: relative;
            height: 6px;
            background: var(--color-glass-border);
            border-radius: 3px;
            margin: 16px 0;
            cursor: pointer;
        }

        .creativity-slider-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--color-purple);
            border-radius: 3px;
            width: 10%;
            transition: width 0.25s ease-in-out;
            box-shadow: var(--shadow-glow);
        }

        .creativity-slider-thumb {
            position: absolute;
            top: 50%;
            left: 0%;
            width: 24px;
            height: 24px;
            background: var(--color-purple);
            border: 3px solid var(--color-glass-border);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            transition: all 0.25s ease-in-out;
            box-shadow: var(--shadow-base);
            z-index: 3;
        }

        .creativity-slider-thumb:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: var(--shadow-base), var(--shadow-glow);
            border-color: var(--color-purple);
        }

        .creativity-slider-thumb:active,
        .creativity-slider-thumb.dragging {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.15);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .creativity-markers {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .creativity-marker {
            position: absolute;
            width: 2px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 1px;
            top: 50%;
            transform: translate(-50%, -50%);
            transition: all 200ms ease;
        }

        .creativity-marker[data-value="1"] { left: 0%; }
        .creativity-marker[data-value="2"] { left: 11.11%; }
        .creativity-marker[data-value="3"] { left: 22.22%; }
        .creativity-marker[data-value="4"] { left: 33.33%; }
        .creativity-marker[data-value="5"] { left: 44.44%; }
        .creativity-marker[data-value="6"] { left: 55.55%; }
        .creativity-marker[data-value="7"] { left: 66.66%; }
        .creativity-marker[data-value="8"] { left: 77.77%; }
        .creativity-marker[data-value="9"] { left: 88.88%; }
        .creativity-marker[data-value="10"] { left: 100%; }

        .creativity-marker.active {
            background: var(--aurora-cyan);
            height: 12px;
            box-shadow: 0 0 8px rgba(116, 249, 255, 0.6);
        }

        /* Radio Buttons - New Design System */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
        }

        .aurora-radio {
            display: none;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius-base);
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.25s ease-in-out;
            color: var(--text-secondary);
            font-family: var(--font-inter);
            font-size: var(--font-size-ui);
            font-weight: var(--font-weight-medium);
            width: 100%;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .radio-label:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--color-purple);
            transform: translateY(-1px);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05), 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .radio-indicator {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            position: relative;
            transition: all 0.25s ease-in-out;
            flex-shrink: 0;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .aurora-radio:checked + .radio-label {
            background: rgba(131, 83, 218, 0.1);
            border-color: var(--color-purple);
            color: var(--text-primary);
        }

        .aurora-radio:checked + .radio-label .radio-indicator {
            background: var(--color-purple);
            border-color: var(--color-purple);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .aurora-radio:checked + .radio-label .radio-indicator::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        /* Checkbox - New Design System */
        .aurora-checkbox {
            width: 20px;
            height: 20px;
            appearance: none;
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--radius-base);
            position: relative;
            cursor: pointer;
            transition: all 0.25s ease-in-out;
        }

        .aurora-checkbox:checked {
            background: var(--color-purple);
            border-color: var(--color-purple);
        }

        .aurora-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        /* Radio Button */
        .aurora-checkbox[type="radio"] {
            border-radius: 50%;
        }

        .aurora-checkbox[type="radio"]:checked::after {
            content: '●';
            font-size: 10px;
            color: white;
        }

        /* Layout Containers - New Design System */
        .sidebar {
            transition: width 0.25s ease-in-out;
            width: 25%;
            min-width: 400px;
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            border-right: 1px solid var(--color-glass-border);
            position: relative;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(131, 83, 218, 0.05) 0%, rgba(149, 103, 228, 0.05) 50%, rgba(111, 65, 195, 0.05) 100%);
            pointer-events: none;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }

        .sidebar-content {
            transition: opacity 0.25s ease-in-out;
            position: relative;
            z-index: 2;
        }

        .main-content {
            transition: width 0.25s ease-in-out;
            width: 75%;
            background: var(--color-black-gradient-start);
        }

        .main-content.expanded {
            width: calc(100% - 80px);
        }

        /* Design Grid - New Design System */
        .design-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 16px;
            grid-auto-rows: minmax(300px, auto);
        }

        .design-card {
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--radius-base);
            overflow: hidden;
            transition: all 0.25s ease-in-out;
            box-shadow: var(--shadow-base);
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            min-height: 300px;
        }

        .design-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        .design-card.generating {
            animation: subtleGenerate 3s ease-in-out infinite;
            border-color: var(--color-purple);
            box-shadow: var(--shadow-base), var(--shadow-glow);
        }

        @keyframes subtleGenerate {
            0%, 100% { 
                transform: translateY(0px);
                box-shadow: var(--shadow-base), var(--shadow-glow);
            }
            50% { 
                transform: translateY(-1px);
                box-shadow: var(--shadow-base), var(--shadow-glow);
            }
        }

        .design-card-header {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            flex-shrink: 0;
        }

        .preview-frame {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            margin: 8px;
            overflow: hidden;
            min-height: 0;
        }

        /* Progress Elements - New Design System */
        .aurora-progress {
            height: 8px;
            background: var(--color-glass-border);
            border-radius: 4px;
            overflow: hidden;
            backdrop-filter: var(--blur-glass);
        }

        .aurora-progress-fill {
            height: 100%;
            background: var(--color-purple);
            border-radius: 4px;
            transition: width 0.25s ease-in-out;
            box-shadow: var(--shadow-glow);
        }

        /* File Dropzone - New Design System */
        .aurora-dropzone {
            border: 2px dashed var(--color-glass-border);
            border-radius: var(--radius-base);
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            transition: all 0.25s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .aurora-dropzone.active {
            border-color: var(--color-purple);
            background: rgba(131, 83, 218, 0.1);
            transform: scale(1.02);
        }

        /* Animations */
        .fade-up {
            animation: fadeUp 300ms cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(24px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Icons with Aurora blend */
        .aurora-icon {
            mix-blend-mode: screen;
            filter: drop-shadow(0 0 8px rgba(116, 249, 255, 0.3));
        }

        /* Scrollbar - New Design System */
        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-content::-webkit-scrollbar-track {
            background: var(--color-glass-border);
            border-radius: 3px;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 3px;
        }

        /* Label styling */
        .aurora-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 8px;
            display: block;
        }

        /* Status text colors - New Design System */
        .status-generating { color: var(--color-purple); }
        .status-complete { color: #4ade80; }
        .status-error { color: #ef4444; }
        .status-paused { color: #fbbf24; }

        /* Toggle button - New Design System */
        .aurora-toggle {
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--radius-base);
            padding: 8px;
            color: var(--text-secondary);
            transition: all 0.25s ease-in-out;
        }

        .aurora-toggle:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .aurora-toggle.rotated {
            transform: rotate(180deg) scale(1.05);
        }

        /* Empty state */
        .empty-state {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 120px);
            text-align: center;
            padding: 48px;
            overflow: hidden;
        }

        .welcome-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .empty-state-icon {
            width: 120px;
            height: 120px;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            border: 1px solid var(--glass-border);
        }

        /* Floating Browsers */
        .floating-browsers-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 30px;
            padding: 40px;
            opacity: 0.2;
            z-index: 1;
        }

        .floating-browser {
            background: var(--color-glass-background);
            backdrop-filter: var(--blur-glass);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--radius-base);
            overflow: hidden;
            animation: floatBrowser 6s ease-in-out infinite;
            box-shadow: var(--shadow-base);
            transition: all 0.25s ease-in-out;
        }

        .floating-browser:nth-child(1) { animation-delay: 0s; }
        .floating-browser:nth-child(2) { animation-delay: -1s; }
        .floating-browser:nth-child(3) { animation-delay: -2s; }
        .floating-browser:nth-child(4) { animation-delay: -3s; }
        .floating-browser:nth-child(5) { animation-delay: -4s; }
        .floating-browser:nth-child(6) { animation-delay: -5s; }

        @keyframes floatBrowser {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1);
                opacity: 0.2;
            }
            25% { 
                transform: translateY(-3px) rotate(0.3deg) scale(1.005);
                opacity: 0.25;
            }
            50% { 
                transform: translateY(-2px) rotate(-0.2deg) scale(1.003);
                opacity: 0.22;
            }
            75% { 
                transform: translateY(-4px) rotate(0.2deg) scale(1.007);
                opacity: 0.27;
            }
        }

        .browser-header {
            height: 32px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid var(--color-glass-border);
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 8px;
        }

        .browser-dots {
            display: flex;
            gap: 6px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            opacity: 0.7;
        }

        .dot.red { background: #ff5f57; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #28ca42; }

        .browser-url {
            flex: 1;
            height: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            animation: urlPulse 3s ease-in-out infinite;
        }

        @keyframes urlPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .browser-content {
            padding: 16px;
            height: 120px;
        }

        .content-lines {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .line {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            animation: linePulse 4s ease-in-out infinite;
        }

        .line.header {
            height: 12px;
            width: 70%;
            background: var(--color-purple);
            opacity: 0.4;
        }

        .line.short { width: 40%; }
        .line.medium { width: 65%; }

        @keyframes linePulse {
            0%, 100% { 
                opacity: 0.2;
                transform: scaleX(1);
            }
            50% { 
                opacity: 0.4;
                transform: scaleX(1.02);
            }
        }

        .line:nth-child(1) { animation-delay: 0s; }
        .line:nth-child(2) { animation-delay: 0.5s; }
        .line:nth-child(3) { animation-delay: 1s; }
        .line:nth-child(4) { animation-delay: 1.5s; }
        .line:nth-child(5) { animation-delay: 2s; }

        /* Generation State Animations */
        .floating-browsers-container.generating {
            opacity: 0.6;
        }

        .floating-browsers-container.generating .floating-browser {
            animation: generatingBrowser 2s ease-in-out infinite;
        }

        @keyframes generatingBrowser {
            0%, 100% { 
                transform: translateY(0px) scale(1);
                box-shadow: var(--shadow-base);
            }
            50% { 
                transform: translateY(-8px) scale(1.05);
                box-shadow: var(--shadow-base), var(--shadow-glow);
            }
        }

        .floating-browsers-container.generating .line {
            animation: generatingLine 1.5s ease-in-out infinite;
        }

        @keyframes generatingLine {
            0%, 100% { 
                opacity: 0.2;
                background: rgba(255, 255, 255, 0.1);
            }
            50% { 
                opacity: 0.6;
                background: var(--color-purple);
            }
        }

        .floating-browsers-container.generating .browser-url {
            animation: generatingUrl 2s ease-in-out infinite;
        }

                 @keyframes generatingUrl {
             0%, 100% { 
                 opacity: 0.3;
                 background: rgba(255, 255, 255, 0.1);
             }
             50% { 
                 opacity: 0.8;
                 background: var(--color-purple);
             }
         }

         /* Welcome Content Animations */
         .sparkle-icon {
             animation: sparkleRotate 4s ease-in-out infinite;
         }

         @keyframes sparkleRotate {
             0%, 100% { 
                 transform: rotate(0deg) scale(1);
                 filter: drop-shadow(0 0 8px rgba(131, 83, 218, 0.3));
             }
             25% { 
                 transform: rotate(5deg) scale(1.05);
                 filter: drop-shadow(0 0 12px rgba(131, 83, 218, 0.5));
             }
             50% { 
                 transform: rotate(0deg) scale(1.1);
                 filter: drop-shadow(0 0 16px rgba(149, 103, 228, 0.4));
             }
             75% { 
                 transform: rotate(-5deg) scale(1.05);
                 filter: drop-shadow(0 0 12px rgba(111, 65, 195, 0.4));
             }
         }

         .welcome-title {
             animation: titleGlow 3s ease-in-out infinite;
             background: linear-gradient(135deg, var(--color-purple), var(--color-purple-hover), var(--color-purple-active));
             background-size: 200% 200%;
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             background-clip: text;
             animation: titleGlow 3s ease-in-out infinite, gradientShift 4s ease-in-out infinite;
         }

         @keyframes titleGlow {
             0%, 100% { 
                 text-shadow: 0 0 20px rgba(131, 83, 218, 0.3);
                 transform: scale(1);
             }
             50% { 
                 text-shadow: 0 0 30px rgba(149, 103, 228, 0.4);
                 transform: scale(1.02);
             }
         }

         @keyframes gradientShift {
             0%, 100% { background-position: 0% 50%; }
             50% { background-position: 100% 50%; }
         }

         .welcome-subtitle {
             animation: subtitleFade 4s ease-in-out infinite;
         }

         @keyframes subtitleFade {
             0%, 100% { opacity: 0.7; }
             50% { opacity: 0.9; }
         }

         /* Feature List Animations */
         .feature-item {
             opacity: 0;
             transform: translateX(-20px);
             animation: slideInStagger 0.8s ease-out forwards;
             transition: all 300ms cubic-bezier(0.16, 1, 0.3, 1);
         }

         .feature-item:nth-child(1) { animation-delay: 0.1s; }
         .feature-item:nth-child(2) { animation-delay: 0.2s; }
         .feature-item:nth-child(3) { animation-delay: 0.3s; }
         .feature-item:nth-child(4) { animation-delay: 0.4s; }
         .feature-item:nth-child(5) { animation-delay: 0.5s; }
         .feature-item:nth-child(6) { animation-delay: 0.6s; }
         .feature-item:nth-child(7) { animation-delay: 0.7s; }

         @keyframes slideInStagger {
             to {
                 opacity: 1;
                 transform: translateX(0);
             }
         }

         .feature-item:hover {
             transform: translateX(10px) scale(1.05);
             background: rgba(131, 83, 218, 0.1);
             border-radius: var(--radius-base);
             padding: 8px 16px;
             margin: -8px -16px;
         }

         .feature-item:hover .feature-icon {
             transform: scale(1.2) rotate(5deg);
             filter: drop-shadow(0 0 12px currentColor);
         }

         .feature-icon {
             transition: all 300ms cubic-bezier(0.16, 1, 0.3, 1);
         }

         /* Enhanced CTA Button */
         .cta-button {
             position: relative;
             overflow: hidden;
             background: var(--color-purple);
             animation: ctaPulse 3s ease-in-out infinite;
             transform: scale(1);
             transition: all 400ms cubic-bezier(0.16, 1, 0.3, 1);
         }

         .cta-button::before {
             content: '';
             position: absolute;
             top: -50%;
             left: -50%;
             width: 200%;
             height: 200%;
             background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
             transform: translateX(-100%);
             transition: transform 600ms;
         }

         .cta-button:hover::before {
             transform: translateX(100%);
         }

         .cta-button:hover {
             transform: translateY(-4px) scale(1.05);
             box-shadow: var(--shadow-base), var(--shadow-glow);
         }

         @keyframes ctaPulse {
             0%, 100% { 
                 box-shadow: var(--shadow-base);
             }
             50% { 
                 box-shadow: var(--shadow-base), var(--shadow-glow);
             }
         }

         /* Enhanced Welcome Content - New Design System */
         .welcome-content-enhanced {
             position: relative;
             z-index: 10;
             padding: 2rem;
             backdrop-filter: var(--blur-glass);
             background: var(--color-glass-background);
             border-radius: var(--radius-base);
             border: 1px solid var(--color-glass-border);
             box-shadow: var(--shadow-base);
         }

         /* Floating Elements */
         .floating-element {
             position: absolute;
             pointer-events: none;
             opacity: 0.6;
         }

         .floating-element-1 {
             top: 20%;
             left: 10%;
             animation: float1 6s ease-in-out infinite;
         }

         .floating-element-2 {
             top: 60%;
             right: 15%;
             animation: float2 8s ease-in-out infinite;
         }

         .floating-element-3 {
             bottom: 30%;
             left: 20%;
             animation: float3 10s ease-in-out infinite;
         }

         @keyframes float1 {
             0%, 100% { transform: translate(0, 0) rotate(0deg); }
             50% { transform: translate(20px, -30px) rotate(180deg); }
         }

         @keyframes float2 {
             0%, 100% { transform: translate(0, 0) rotate(0deg); }
             50% { transform: translate(-30px, 20px) rotate(-180deg); }
         }

                   @keyframes float3 {
              0%, 100% { transform: translate(0, 0) rotate(0deg); }
              50% { transform: translate(25px, -20px) rotate(90deg); }
          }

         /* Floating Particles */
         .floating-particles {
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             pointer-events: none;
             overflow: hidden;
         }

         .particle {
             position: absolute;
             width: 4px;
             height: 4px;
             background: var(--color-purple);
             border-radius: 50%;
             opacity: 0.6;
             animation: floatParticle 8s linear infinite;
         }

         .particle:nth-child(1) {
             left: 20%;
             animation-delay: 0s;
             animation-duration: 8s;
         }

         .particle:nth-child(2) {
             left: 40%;
             animation-delay: -2s;
             animation-duration: 10s;
             background: var(--aurora-purple);
         }

         .particle:nth-child(3) {
             left: 60%;
             animation-delay: -4s;
             animation-duration: 12s;
             background: var(--aurora-pink);
         }

         .particle:nth-child(4) {
             left: 80%;
             animation-delay: -6s;
             animation-duration: 9s;
         }

         .particle:nth-child(5) {
             left: 30%;
             animation-delay: -1s;
             animation-duration: 11s;
             background: var(--aurora-purple);
         }

         @keyframes floatParticle {
             0% {
                 transform: translateY(100vh) translateX(0px) scale(0);
                 opacity: 0;
             }
             10% {
                 opacity: 0.6;
                 transform: translateY(90vh) translateX(10px) scale(1);
             }
             90% {
                 opacity: 0.6;
                 transform: translateY(10vh) translateX(-10px) scale(1);
             }
             100% {
                 transform: translateY(0vh) translateX(0px) scale(0);
                 opacity: 0;
             }
         }

         /* Top Progress Bar - New Design System */
         #topProgressBar {
             position: relative;
             height: 3px;
             background: var(--color-glass-border);
             overflow: hidden;
         }

         .top-progress-fill {
             height: 100%;
             width: 0%;
             background: var(--color-purple);
             background-size: 200% 100%;
             animation: progressShimmer 2s ease-in-out infinite;
             transition: width 0.25s ease-in-out;
         }

         @keyframes progressShimmer {
             0%, 100% { background-position: 200% 0; }
             50% { background-position: -200% 0; }
         }

         /* Fullscreen Design Viewer - New Design System */
         .fullscreen-viewer {
             position: fixed;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: rgba(0, 0, 0, 0.95);
             backdrop-filter: var(--blur-glass);
             z-index: 100;
             display: none;
             animation: fadeIn 0.25s ease-out;
         }

         .fullscreen-viewer.active {
             display: flex;
             flex-direction: column;
         }

         .fullscreen-header {
             height: 60px;
             background: var(--glass-bg);
             backdrop-filter: blur(16px);
             border-bottom: 1px solid var(--glass-border);
             display: flex;
             align-items: center;
             justify-content: space-between;
             padding: 0 24px;
         }

         .fullscreen-content {
             flex: 1;
             padding: 24px;
             overflow: hidden;
         }

         .fullscreen-iframe {
             width: 100%;
             height: 100%;
             border: none;
             border-radius: 12px;
             background: white;
             box-shadow: 0 24px 48px rgba(0, 0, 0, 0.3);
         }

         @keyframes fadeIn {
             from { opacity: 0; }
             to { opacity: 1; }
         }

         /* Design Card Enhancements */
         .design-card.generating {
             animation: subtleGenerate 3s ease-in-out infinite;
             border-color: var(--aurora-cyan);
             box-shadow: 0 16px 32px -8px var(--glass-shadow), 0 0 0 1px rgba(116, 249, 255, 0.2);
         }

         @keyframes subtleGenerate {
             0%, 100% { 
                 transform: translateY(0px) scale(1);
                 box-shadow: 0 16px 32px -8px var(--glass-shadow), 0 0 0 1px rgba(116, 249, 255, 0.2);
             }
             50% { 
                 transform: translateY(-2px) scale(1.01);
                 box-shadow: 0 20px 40px -8px var(--glass-shadow), 0 0 0 1px rgba(116, 249, 255, 0.4);
             }
         }

         /* Generation Placeholder Styles */
         .generating-placeholder {
             opacity: 0.8;
         }

         .border-aurora-cyan {
             border-color: var(--aurora-cyan);
         }

         .border-t-transparent {
             border-top-color: transparent;
         }

         .from-aurora-cyan\/10 {
             --tw-gradient-from: rgba(116, 249, 255, 0.1);
         }

         .to-aurora-purple\/10 {
             --tw-gradient-to: rgba(184, 106, 223, 0.1);
         }

        /* 8pt grid system */
        .space-1 { margin: 8px; }
        .space-2 { margin: 16px; }
        .space-3 { margin: 24px; }
        .space-4 { margin: 32px; }
        .space-5 { margin: 40px; }
        .space-6 { margin: 48px; }

        .p-1 { padding: 8px; }
        .p-2 { padding: 16px; }
        .p-3 { padding: 24px; }
        .p-4 { padding: 32px; }

        /* Bouncing dots animation */
                 .bg-aurora-cyan {
             background-color: var(--color-purple);
         }
         
         .bg-aurora-purple {
             background-color: var(--color-purple-hover);
         }
         
         .bg-aurora-pink {
             background-color: var(--color-purple-active);
         }

        /* Mobile responsiveness */
        @media (max-width: 1024px) {
            .sidebar { width: 35%; min-width: 350px; }
            .main-content { width: 65%; }
            .main-content.expanded { width: calc(100% - 80px); }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                min-width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 40;
                transform: translateX(-100%);
            }
            .sidebar.open { transform: translateX(0); }
            .sidebar.collapsed { transform: translateX(-100%); }
            .main-content { width: 100%; }
            .main-content.expanded { width: 100%; }
            .mobile-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(8px);
                z-index: 30;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans antialiased overflow-hidden">
    <!-- Main Layout Container -->
    <div class="flex h-screen">
        <!-- Mobile Overlay -->
        <div id="mobileOverlay" class="mobile-overlay hidden lg:hidden"></div>
        
        <!-- Left Sidebar (25% width) -->
        <div id="sidebar" class="sidebar flex flex-col overflow-hidden">
            <!-- Sidebar Header -->
            <div class="flex-shrink-0 p-3 border-b border-white border-opacity-20 flex justify-between items-center">
                <div class="sidebar-content">
                    <h1 class="heading-sm text-white">Bulk Design Generator</h1>
                    <p class="text-sm text-white text-opacity-70 mt-1">AI-powered design variations</p>
                </div>
                <button id="apiSettingsBtn" class="aurora-toggle rounded-lg transition-colors">
                    <i data-lucide="settings" class="w-5 h-5 aurora-icon"></i>
                </button>
            </div>
            
            <!-- Sidebar Content -->
            <div class="sidebar-content flex-1 overflow-y-auto p-3">
                <!-- Generator Form -->
                <div class="space-y-4 fade-up">
                    <!-- Main Configuration Section -->
                    <div class="glass-card p-4">
                        <!-- Prompt Section -->
                        <div class="mb-4">
                            <label for="mainPrompt" class="aurora-label">Main Design Prompt</label>
                            <textarea id="mainPrompt" rows="3" class="aurora-input w-full rounded-lg transition" placeholder="Example: 'a landing page for School Sports Day Event'&#10;&#10;For bulk prompts, use:&#10;* landing page for restaurant&#10;* portfolio website for photographer&#10;* e-commerce store for clothing"></textarea>
                        </div>

                        <!-- Prompt Modifier Section -->
                        <div class="mb-4">
                            <label for="promptModifier" class="aurora-label">Prompt Modifier (Optional)</label>
                            <textarea id="promptModifier" rows="2" class="aurora-input w-full rounded-lg transition" placeholder="Additional requirements or modifications to apply to every generated design..."></textarea>
                        </div>

                        <!-- Subtle Divider -->
                        <div class="border-t border-white border-opacity-10 my-4"></div>

                        <!-- Variations Type -->
                        <div class="mb-4">
                            <label class="aurora-label">Variations</label>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                <button class="variations-type-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all active" data-value="close">
                                    Close Variations
                                </button>
                                <button class="variations-type-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all" data-value="unique">
                                    Unique Variations
                                </button>
                            </div>
                        </div>

                        <!-- Subtle Divider -->
                        <div class="border-t border-white border-opacity-10 my-4"></div>

                        <!-- Number of Variations -->
                        <div class="mb-4">
                            <label class="aurora-label">Number of Variations</label>
                            <div class="grid grid-cols-4 gap-2 mt-2">
                                <button class="variation-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all active" data-value="5">5</button>
                                <button class="variation-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all" data-value="10">10</button>
                                <button class="variation-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all" data-value="20">20</button>
                                <button class="variation-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all" data-value="50">50</button>
                            </div>
                        </div>

                        <!-- Subtle Divider -->
                        <div class="border-t border-white border-opacity-10 my-4"></div>

                        <!-- Creativity Level -->
                        <div>
                            <label class="aurora-label">Creativity Level</label>
                            <div class="creativity-slider-container">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-xs text-white text-opacity-60 font-medium">Conservative</span>
                                                                         <span id="creativityValue" class="text-sm font-semibold" style="color: var(--color-purple)">1</span>
                                    <span class="text-xs text-white text-opacity-60 font-medium">Creative</span>
                                </div>
                                <div class="creativity-slider-track">
                                    <div class="creativity-slider-fill" id="creativityFill"></div>
                                    <div class="creativity-slider-thumb" id="creativityThumb" data-value="1"></div>
                                    <div class="creativity-markers">
                                        <div class="creativity-marker" data-value="1"></div>
                                        <div class="creativity-marker" data-value="2"></div>
                                        <div class="creativity-marker" data-value="3"></div>
                                        <div class="creativity-marker" data-value="4"></div>
                                        <div class="creativity-marker" data-value="5"></div>
                                        <div class="creativity-marker" data-value="6"></div>
                                        <div class="creativity-marker" data-value="7"></div>
                                        <div class="creativity-marker" data-value="8"></div>
                                        <div class="creativity-marker" data-value="9"></div>
                                        <div class="creativity-marker" data-value="10"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Model Selection (Hidden) -->
                    <div class="glass-card p-3 hidden">
                        <label for="aiModel" class="aurora-label">AI Model</label>
                        <select id="aiModel" class="aurora-select w-full rounded-lg transition">
                            <option value="deepseek/deepseek-chat-v3-0324:free">deepseek/deepseek-chat-v3-0324:free (Free)</option>
                            <option value="deepseek/deepseek-chat-v3-0324">deepseek/deepseek-chat-v3-0324 (Paid)</option>
                        </select>
                    </div>

                    <!-- Custom Prompts Toggle -->
                    <div class="glass-card p-3">
                        <label class="aurora-label">I have my own prompts</label>
                        <div class="grid grid-cols-2 gap-2 mt-2 mb-3">
                            <button class="custom-prompts-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all" data-value="yes">
                                Yes
                            </button>
                            <button class="custom-prompts-btn glass-button py-2 px-3 rounded-lg text-sm font-medium transition-all active" data-value="no">
                                No
                            </button>
                        </div>
                        
                        <!-- Custom Prompts Container -->
                        <div id="customPromptsContainer" class="hidden space-y-3">
                            <!-- File Dropzone -->
                            <div>
                                <label class="aurora-label">Upload Prompts File</label>
                                <div id="fileDropzone" class="aurora-dropzone rounded-lg p-4 text-center cursor-pointer transition">
                                    <div class="flex flex-col items-center justify-center space-y-2">
                                        <i data-lucide="upload-cloud" class="w-8 h-8 text-white text-opacity-60 aurora-icon"></i>
                                        <p class="text-sm text-white text-opacity-80">
                                            <span class="font-medium" style="color: var(--aurora-cyan)">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-white text-opacity-60">JSON or TXT files up to 10MB</p>
                                    </div>
                                    <input id="promptsFile" type="file" class="hidden" accept=".json,.txt">
                                </div>
                            </div>

                            <!-- Or Divider -->
                            <div class="relative">
                                <div class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-white border-opacity-20"></div>
                                </div>
                                <div class="relative flex justify-center">
                                    <span class="px-3 text-sm text-white text-opacity-70" style="background: rgba(12, 12, 12, 0.4);">OR</span>
                                </div>
                            </div>

                            <!-- Text Area for Prompts -->
                            <div>
                                <label for="customPrompts" class="aurora-label">Paste Prompts</label>
                                <textarea id="customPrompts" rows="4" class="aurora-input w-full rounded-lg transition" placeholder="Enter one prompt per line"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="pt-2">
                        <button id="generateBtn" class="aurora-button w-full py-4 px-6 rounded-lg shadow-lg transition flex items-center justify-center gap-3">
                            <i data-lucide="sparkles" class="w-5 h-5"></i>
                            <span class="font-semibold">Generate Designs</span>
                        </button>
                    </div>
                </div>


            </div>
        </div>

        <!-- Right Main Content (75% width) -->
        <div id="mainContent" class="main-content flex flex-col overflow-hidden">
            <!-- Top Progress Bar -->
            <div id="topProgressBar" class="hidden">
                <div class="top-progress-fill"></div>
            </div>
            
            <!-- Header Bar -->
                         <div class="flex-shrink-0 px-6 py-4" style="background: var(--color-glass-background); backdrop-filter: var(--blur-glass); border-bottom: 1px solid var(--color-glass-border);">
                <div class="flex justify-between items-center">
                    <!-- Mobile Menu Button -->
                    <button id="mobileMenuBtn" class="lg:hidden aurora-toggle p-2 rounded-lg">
                        <i data-lucide="menu" class="w-5 h-5 aurora-icon"></i>
                    </button>
                    
                    <div class="flex items-center space-x-4">
                        
                        <!-- Progress Tracker (moved from sidebar) -->
                        <div id="headerProgressContainer" class="hidden">
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm text-white text-opacity-80">
                                        <span id="headerCompletedCount" class="font-medium mono" style="color: var(--aurora-cyan)">0</span>/<span id="headerTotalCount" class="font-medium mono" style="color: var(--aurora-cyan)">0</span>
                                    </span>
                                    <span id="headerStatusText" class="text-sm font-medium status-generating">Ready</span>
                                </div>
                                <div class="flex gap-2">
                                    <button id="headerPauseBtn" class="glass-button p-2 rounded transition-colors" title="Pause">
                                        <i data-lucide="pause" class="w-4 h-4 aurora-icon"></i>
                                    </button>
                                    <button id="headerResumeBtn" class="glass-button p-2 rounded transition-colors hidden" title="Resume">
                                        <i data-lucide="play" class="w-4 h-4 aurora-icon"></i>
                                    </button>
                                    <button id="headerStopBtn" class="glass-button p-2 rounded transition-colors hover:bg-red-500 hover:bg-opacity-20" title="Stop">
                                        <i data-lucide="square" class="w-4 h-4 aurora-icon"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="resultsContainer" class="hidden">
                            <button id="downloadAllBtn" class="aurora-button flex items-center gap-2 py-2 px-4 rounded-lg">
                                <i data-lucide="download" class="w-4 h-4"></i>
                                <span class="font-medium">Download All</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Designs Grid Area -->
            <div class="flex-1 overflow-y-auto">
                <div id="designsGrid" class="design-grid"></div>
                
                <!-- Empty State -->
                <div id="emptyState" class="empty-state">
                    <!-- Landing Page Content -->
                    <div class="welcome-content welcome-content-enhanced">
                        <!-- Floating Decorative Elements -->
                        <div class="floating-element floating-element-1">
                            <i data-lucide="zap" class="w-8 h-8" style="color: var(--aurora-cyan)"></i>
                        </div>
                        <div class="floating-element floating-element-2">
                            <i data-lucide="stars" class="w-6 h-6" style="color: var(--aurora-purple)"></i>
                        </div>
                        <div class="floating-element floating-element-3">
                            <i data-lucide="palette" class="w-7 h-7" style="color: var(--aurora-pink)"></i>
                        </div>
                        
                        <div class="empty-state-icon">
                            <i data-lucide="sparkles" class="w-20 h-20 sparkle-icon" style="color: var(--aurora-cyan)"></i>
                        </div>
                        
                        <h1 class="text-4xl md:text-5xl welcome-title mb-6 text-center font-bold leading-tight">
                            Generate Dozens of Designs from a Single Prompt
                        </h1>
                        
                        <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-8">
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="server-off" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">No Server, No Python, No Coding.</span>
                            </div>
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="gift" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">100% Free, No Signup Needed</span>
                            </div>
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="infinity" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">Unlimited design variations</span>
                            </div>
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="play" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">Works in the background</span>
                            </div>
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="settings-2" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">Fully or Semi-automated</span>
                            </div>
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="repeat" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">Run multiple campaigns</span>
                            </div>
                            <div class="feature-item flex items-center gap-4 text-white text-opacity-90 text-lg">
                                <i data-lucide="award" class="feature-icon w-6 h-6 flex-shrink-0" style="color: var(--aurora-cyan)"></i>
                                <span class="font-medium">Pick the most stunning design</span>
                            </div>
                        </div>
                        
                        <p class="text-xl welcome-subtitle text-center mb-8 text-white text-opacity-80 font-medium leading-relaxed">
                            Make your projects truly shine, by choosing an extra-ordinary design from 100s of good designs.
                        </p>
                        
                        <div class="text-center">
                            <button onclick="document.getElementById('mainPrompt').focus()" class="cta-button py-5 px-10 text-xl font-bold rounded-2xl shadow-2xl flex items-center gap-4 mx-auto text-black relative z-10">
                                <i data-lucide="rocket" class="w-7 h-7"></i>
                                <span>Get Started - Enter Your First Prompt</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Floating Browser Grid -->
                    <div id="floatingBrowsers" class="floating-browsers-container">
                        <div class="floating-browser" data-delay="0">
                            <div class="browser-header">
                                <div class="browser-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <div class="browser-url"></div>
                            </div>
                            <div class="browser-content">
                                <div class="content-lines">
                                    <div class="line header"></div>
                                    <div class="line"></div>
                                    <div class="line short"></div>
                                    <div class="line"></div>
                                    <div class="line medium"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="floating-browser" data-delay="200">
                            <div class="browser-header">
                                <div class="browser-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <div class="browser-url"></div>
                            </div>
                            <div class="browser-content">
                                <div class="content-lines">
                                    <div class="line header"></div>
                                    <div class="line medium"></div>
                                    <div class="line"></div>
                                    <div class="line short"></div>
                                    <div class="line"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="floating-browser" data-delay="400">
                            <div class="browser-header">
                                <div class="browser-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <div class="browser-url"></div>
                            </div>
                            <div class="browser-content">
                                <div class="content-lines">
                                    <div class="line header"></div>
                                    <div class="line short"></div>
                                    <div class="line"></div>
                                    <div class="line medium"></div>
                                    <div class="line"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="floating-browser" data-delay="600">
                            <div class="browser-header">
                                <div class="browser-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <div class="browser-url"></div>
                            </div>
                            <div class="browser-content">
                                <div class="content-lines">
                                    <div class="line header"></div>
                                    <div class="line"></div>
                                    <div class="line medium"></div>
                                    <div class="line short"></div>
                                    <div class="line"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="floating-browser" data-delay="800">
                            <div class="browser-header">
                                <div class="browser-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <div class="browser-url"></div>
                            </div>
                            <div class="browser-content">
                                <div class="content-lines">
                                    <div class="line header"></div>
                                    <div class="line medium"></div>
                                    <div class="line short"></div>
                                    <div class="line"></div>
                                    <div class="line"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="floating-browser" data-delay="1000">
                            <div class="browser-header">
                                <div class="browser-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <div class="browser-url"></div>
                            </div>
                            <div class="browser-content">
                                <div class="content-lines">
                                    <div class="line header"></div>
                                    <div class="line short"></div>
                                    <div class="line medium"></div>
                                    <div class="line"></div>
                                    <div class="line short"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Floating Particles -->
                    <div class="floating-particles">
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Design Viewer -->
    <div id="fullscreenViewer" class="fullscreen-viewer">
        <div class="fullscreen-header">
            <div class="flex items-center gap-4">
                <h3 id="fullscreenTitle" class="text-lg font-semibold text-white">Design Preview</h3>
            </div>
            <button id="minimizeBtn" class="aurora-toggle p-2 rounded-lg">
                <i data-lucide="minimize-2" class="w-5 h-5 aurora-icon"></i>
            </button>
        </div>
        <div class="fullscreen-content">
            <iframe id="fullscreenIframe" class="fullscreen-iframe"></iframe>
        </div>
    </div>

    <!-- API Settings Modal -->
    <div id="apiSettingsModal" class="fixed inset-0 flex items-center justify-center hidden z-50 p-4" style="background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);">
        <div class="glass-card w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="px-6 py-4 border-b border-white border-opacity-20 flex justify-between items-center sticky top-0 bg-inherit">
                <h3 class="heading-sm text-white">API Settings</h3>
                <button id="closeModalBtn" class="aurora-toggle p-2 rounded transition-colors">
                    <i data-lucide="x" class="w-5 h-5 aurora-icon"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <!-- API Key Input -->
                <div>
                    <label for="apiKey" class="aurora-label">OpenRouter API Key</label>
                    <div class="relative">
                        <input id="apiKey" type="password" class="aurora-input w-full pr-12">
                        <button id="toggleApiKeyVisibility" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                            <i data-lucide="eye" class="w-5 h-5 text-white text-opacity-60 hover:text-white transition-colors aurora-icon"></i>
                        </button>
                    </div>
                    <p class="mt-2 text-sm text-white text-opacity-60">Get your API key from <a href="https://openrouter.ai/" target="_blank" class="hover:underline" style="color: var(--aurora-cyan)">OpenRouter</a></p>
                </div>

                <!-- Multi Model Checkbox -->
                <div>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input id="multiModelCheckbox" type="checkbox" class="aurora-checkbox">
                        <span class="aurora-label mb-0">Multi Model</span>
                    </label>
                    <p class="mt-1 text-xs text-white text-opacity-60">Run prompts across multiple models (up to 10)</p>
                </div>

                <!-- Model Selection -->
                <div id="modelSelectionContainer">
                    <label for="modalAiModel" class="aurora-label">AI Model</label>
                    <select id="modalAiModel" class="aurora-select w-full">
                        <!-- DeepSeek Models (Free) -->
                        <optgroup label="DeepSeek (Free)">
                            <option value="deepseek/deepseek-v3-0324:free">DeepSeek V3 0324 (Mar 2025) - 685B params - 164K ctx</option>
                            <option value="deepseek/deepseek-r1-zero:free">DeepSeek R1 Zero (Jan 2025) - 671B params - 164K ctx</option>
                            <option value="deepseek/deepseek-r1-distill-qwen-32b:free">DeepSeek R1 Distill Qwen 32B (Feb 2025) - 32B params - 16K ctx</option>
                            <option value="deepseek/deepseek-r1-distill-qwen-14b:free">DeepSeek R1 Distill Qwen 14B (Feb 2025) - 14B params - 64K ctx</option>
                            <option value="deepseek/deepseek-r1-distill-llama-70b:free">DeepSeek R1 Distill Llama 70B (Feb 2025) - 70B params - 8K ctx</option>
                            <option value="deepseek/deepseek-r1:free">DeepSeek R1 (Jan 2025) - 671B params - 164K ctx</option>
                            <option value="deepseek/deepseek-v3:free">DeepSeek V3 (Dec 2024) - 685B params - 164K ctx</option>
                            <option value="deepseek/deepseek-chat-v3-0324:free" selected>DeepSeek Chat V3 0324 (Mar 2025) - 685B params - 128K ctx</option>
                        </optgroup>
                        
                        <!-- Google Models (Free) -->
                        <optgroup label="Google (Free)">
                            <option value="google/gemini-2.5-pro-exp-03-25:free">Gemini 2.5 Pro Experimental (Mar 2025) - 1M ctx</option>
                            <option value="google/gemma-3-27b-it:free">Gemma 3 27B (Mar 2025) - 27B params - 131K ctx</option>
                            <option value="google/gemini-2.0-flash-exp:free">Gemini 2.0 Flash Experimental (Dec 2024) - 1M ctx</option>
                            <option value="google/learnlm-1.5-pro-experimental">LearnLM 1.5 Pro Experimental (Nov 2024) - 40K ctx</option>
                        </optgroup>
                        
                        <!-- Qwen Models (Free) -->
                        <optgroup label="Qwen (Free)">
                            <option value="qwen/qwen3-30b-a3b:free">Qwen3-30B-A3B (Apr 2025) - 30B params - 128K ctx</option>
                            <option value="qwen/qwen3-235b-a22b:free">Qwen3-235B-A22B (Apr 2025) - 235B params - 128K ctx</option>
                            <option value="qwen/qwen-2.5-coder-32b-instruct:free">Qwen 2.5 Coder 32B Instruct (Nov 2024) - 32B params - 131K ctx</option>
                            <option value="qwen/qwen-2.5-72b-instruct:free">Qwen 2.5 72B Instruct (Sep 2024) - 72B params - 131K ctx</option>
                        </optgroup>
                        
                        <!-- Meta Models (Free) -->
                        <optgroup label="Meta (Free)">
                            <option value="meta-llama/llama-3.2-90b-vision-instruct:free">Llama 3.2 90B Vision Instruct (Sep 2024) - 90B params - 131K ctx</option>
                            <option value="meta-llama/llama-3.2-11b-vision-instruct:free">Llama 3.2 11B Vision Instruct (Sep 2024) - 11B params - 131K ctx</option>
                            <option value="meta-llama/llama-3.2-3b-instruct:free">Llama 3.2 3B Instruct (Sep 2024) - 3B params - 131K ctx</option>
                            <option value="meta-llama/llama-3.2-1b-instruct:free">Llama 3.2 1B Instruct (Sep 2024) - 1B params - 131K ctx</option>
                            <option value="meta-llama/llama-3.1-8b-instruct:free">Llama 3.1 8B Instruct (Jul 2024) - 8B params - 131K ctx</option>
                        </optgroup>
                        
                        <!-- Microsoft Models (Free) -->
                        <optgroup label="Microsoft (Free)">
                            <option value="microsoft/phi-3-mini-128k-instruct:free">Phi-3 Mini 128K Instruct (Apr 2024) - 3.8B params - 128K ctx</option>
                            <option value="microsoft/phi-3-medium-128k-instruct:free">Phi-3 Medium 128K Instruct (Apr 2024) - 14B params - 128K ctx</option>
                        </optgroup>
                        
                        <!-- Mistral Models (Free) -->
                        <optgroup label="Mistral (Free)">
                            <option value="mistralai/mistral-7b-instruct:free">Mistral 7B Instruct v0.1 (Sep 2023) - 7B params - 32K ctx</option>
                            <option value="mistralai/codestral-mamba:free">Codestral Mamba (Jul 2024) - 7B params - 256K ctx</option>
                        </optgroup>
                        
                        <!-- Hugging Face Models (Free) -->
                        <optgroup label="Hugging Face (Free)">
                            <option value="huggingfaceh4/zephyr-7b-beta:free">Zephyr 7B Beta (Oct 2023) - 7B params - 32K ctx</option>
                        </optgroup>
                        
                        <!-- OpenChat Models (Free) -->
                        <optgroup label="OpenChat (Free)">
                            <option value="openchat/openchat-7b:free">OpenChat 7B (Jul 2023) - 7B params - 8K ctx</option>
                        </optgroup>
                        
                        <!-- Gryphe Models (Free) -->
                        <optgroup label="Gryphe (Free)">
                            <option value="gryphe/mythomist-7b:free">MythoMist 7B (Jan 2024) - 7B params - 32K ctx</option>
                        </optgroup>
                        
                        <!-- Undi95 Models (Free) -->
                        <optgroup label="Undi95 (Free)">
                            <option value="undi95/toppy-m-7b:free">Toppy M 7B (Dec 2023) - 7B params - 4K ctx</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Multi Model Selection Container (Hidden by default) -->
                <div id="multiModelContainer" class="hidden">
                    <label class="aurora-label">Select Models (Max 10)</label>
                    <div id="multiModelList" class="space-y-2 max-h-48 overflow-y-auto border border-white border-opacity-20 rounded-lg p-3 bg-black bg-opacity-20">
                        <!-- Model checkboxes will be populated here -->
                    </div>
                    <p class="text-xs text-white text-opacity-60 mt-2">Selected: <span id="selectedModelCount">0</span>/10</p>
                </div>

                <!-- Download Mode -->
                <div>
                    <label for="downloadModeSelect" class="aurora-label">Download Mode</label>
                    <select id="downloadModeSelect" class="aurora-select w-full">
                        <option value="auto">Auto Download</option>
                        <option value="manual">Manual Download</option>
                    </select>
                </div>

                <!-- Download Prompts -->
                <div>
                    <label for="downloadPromptsSelect" class="aurora-label">Download Prompts</label>
                    <select id="downloadPromptsSelect" class="aurora-select w-full">
                        <option value="no">No</option>
                        <option value="yes">Yes</option>
                    </select>
                </div>

                <!-- Save Button -->
                <div class="pt-4">
                    <button id="saveSettingsBtn" class="aurora-button w-full py-3 px-6 rounded-lg flex items-center justify-center gap-3">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span class="font-semibold">Save Settings</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Simple debug mode
        let debugMode = false;

        // System Prompts
        const SYSTEM_PROMPT_1 = `You are an expert web design prompt enhancer. Your primary goal is to take user prompts and ENHANCE them into detailed, comprehensive design briefs while preserving the core intent.

🎯 CORE PRINCIPLES:
1. ALWAYS maintain the user's original concept, industry, and purpose
2. ENHANCE the prompt by adding specific details, sections, and functionality
3. Make each variation more detailed and actionable than the original
4. Preserve the target audience and business objectives
5. Add professional design specifications and modern web features

✅ ENHANCEMENT APPROACH:
• Add specific sections (hero, features, testimonials, pricing, contact, etc.)
• Include detailed layout descriptions (navigation style, content organization)
• Specify modern UI components (cards, buttons, forms, interactive elements)
• Add responsive design considerations and accessibility features
• Include color scheme suggestions appropriate to the industry
• Add typography and visual hierarchy details
• Specify calls-to-action and user journey elements
• Include modern web features (animations, hover effects, etc.)

❌ NEVER CHANGE:
• The core business purpose or industry focus
• The target audience or user needs
• Essential requirements mentioned by the user
• The type of website/application specified

🎨 ENHANCEMENT GOAL:
Transform brief user prompts into comprehensive design briefs that give designers everything they need to create professional, modern websites. Each enhanced prompt should be 3-5x more detailed than the original while staying true to the user's vision.`;

        const SYSTEM_PROMPT_2 = `You are a professional Tailwind CSS designer. Create HTML designs that EXACTLY match the prompt requirements while being visually appealing and modern.

📋 TECHNICAL REQUIREMENTS:
- Use only HTML, Tailwind CSS, and minimal JavaScript
- Include Tailwind CSS CDN: https://cdn.tailwindcss.com
- Enclose everything within <html>...</html> tags (no content outside)
- Add appropriate icon libraries if needed (Heroicons, Lucide, Font Awesome)
- Use custom CSS in <style> tags only when Tailwind is insufficient
- Ensure responsive design with mobile-first approach

🎯 DESIGN APPROACH:
- Follow the prompt specifications precisely - this is critical
- Identify the core purpose and target audience from the prompt
- Create layouts that serve the stated business objectives
- Use modern, clean design principles while staying true to requirements
- Ensure excellent user experience and accessibility
- Make it visually appealing while maintaining functional focus

⚠️ IMPORTANT: Accuracy to the prompt requirements is more important than creative interpretation. The design must solve the specific problem or serve the specific purpose mentioned in the prompt.`;

        // DOM Elements
        const apiSettingsBtn = document.getElementById('apiSettingsBtn');
        const apiSettingsModal = document.getElementById('apiSettingsModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const generateBtn = document.getElementById('generateBtn');
        const customPromptsToggle = document.getElementById('customPromptsToggle');
        const customPromptsContainer = document.getElementById('customPromptsContainer');
        const progressContainer = document.getElementById('progressContainer');
        const headerProgressContainer = document.getElementById('headerProgressContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        const designsGrid = document.getElementById('designsGrid');
        const completedCount = document.getElementById('completedCount');
        const totalCount = document.getElementById('totalCount');
        const headerCompletedCount = document.getElementById('headerCompletedCount');
        const headerTotalCount = document.getElementById('headerTotalCount');
        const progressFill = document.getElementById('progressFill');
        const statusText = document.getElementById('statusText');
        const headerStatusText = document.getElementById('headerStatusText');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const headerPauseBtn = document.getElementById('headerPauseBtn');
        const headerResumeBtn = document.getElementById('headerResumeBtn');
        const headerStopBtn = document.getElementById('headerStopBtn');
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        const apiKeyInput = document.getElementById('apiKey');
        const modalAiModel = document.getElementById('modalAiModel');
        const mainAiModel = document.getElementById('aiModel');
        const fileDropzone = document.getElementById('fileDropzone');
        const promptsFileInput = document.getElementById('promptsFile');
        const toggleApiKeyVisibility = document.getElementById('toggleApiKeyVisibility');
        const mainPrompt = document.getElementById('mainPrompt');
        const promptModifier = document.getElementById('promptModifier');
        const currentPromptDisplay = document.getElementById('currentPromptDisplay');
        const currentPromptText = document.getElementById('currentPromptText');
        const minimizeBtn = document.getElementById('minimizeBtn');
        
        // New DOM Elements for Layout
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const emptyState = document.getElementById('emptyState');

        // Multi-Model DOM Elements
        const multiModelCheckbox = document.getElementById('multiModelCheckbox');
        const modelSelectionContainer = document.getElementById('modelSelectionContainer');
        const multiModelContainer = document.getElementById('multiModelContainer');
        const multiModelList = document.getElementById('multiModelList');
        const selectedModelCount = document.getElementById('selectedModelCount');

        // State variables
        let isGenerating = false;
        let isPaused = false;
        let currentIndex = 0;
        let prompts = [];
        let generatedDesigns = [];
        let apiKeyVisible = false;
        let generationQueue = [];
        let sidebarCollapsed = false;
        let isMultiModel = false;
        let selectedModels = [];

        // Event Listeners
        apiSettingsBtn.addEventListener('click', () => {
            apiSettingsModal.classList.remove('hidden');
        });

        closeModalBtn.addEventListener('click', () => {
            apiSettingsModal.classList.add('hidden');
        });

        saveSettingsBtn.addEventListener('click', saveSettings);
        generateBtn.addEventListener('click', startGeneration);
        if (pauseBtn) pauseBtn.addEventListener('click', pauseGeneration);
        if (resumeBtn) resumeBtn.addEventListener('click', resumeGeneration);
        if (stopBtn) stopBtn.addEventListener('click', stopGeneration);
        if (headerPauseBtn) headerPauseBtn.addEventListener('click', pauseGeneration);
        if (headerResumeBtn) headerResumeBtn.addEventListener('click', resumeGeneration);
        if (headerStopBtn) headerStopBtn.addEventListener('click', stopGeneration);
        
        // Fix: Add event listener to downloadAllBtn only if it exists
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', downloadAllDesigns);
        }
        
        toggleApiKeyVisibility.addEventListener('click', toggleApiKeyVisibilityHandler);
        minimizeBtn.addEventListener('click', closeFullscreenViewer);

        // New Event Listeners for Layout
        mobileMenuBtn.addEventListener('click', toggleMobileSidebar);
        mobileOverlay.addEventListener('click', closeMobileSidebar);

        // Multi-Model Event Listeners
        if (multiModelCheckbox) {
            multiModelCheckbox.addEventListener('change', toggleMultiModel);
        }

        // File dropzone events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileDropzone.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            fileDropzone.addEventListener(eventName, highlightDropzone, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileDropzone.addEventListener(eventName, unhighlightDropzone, false);
        });

        fileDropzone.addEventListener('drop', handleDrop, false);
        fileDropzone.addEventListener('click', () => promptsFileInput.click());
        promptsFileInput.addEventListener('change', handleFileSelect);

        // Button Group Functions
        function initializeButtonGroups() {
            // Variations Type Buttons
            document.querySelectorAll('.variations-type-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.variations-type-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Variation Count Buttons
            document.querySelectorAll('.variation-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.variation-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Custom Prompts Buttons
            document.querySelectorAll('.custom-prompts-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.custom-prompts-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const isCustom = btn.dataset.value === 'yes';
                    customPromptsContainer.classList.toggle('hidden', !isCustom);
                    
                    if (!isCustom) {
                        // Clear custom prompts when switching to "No"
                        promptsFileInput.value = '';
                        document.getElementById('customPrompts').value = '';
                        const dropzoneContent = fileDropzone.querySelector('div');
                        dropzoneContent.innerHTML = `
                            <div class="flex flex-col items-center justify-center space-y-2">
                                <i data-lucide="upload-cloud" class="w-8 h-8 text-white text-opacity-60 aurora-icon"></i>
                                <p class="text-sm text-white text-opacity-80">
                                    <span class="font-medium" style="color: var(--aurora-cyan)">Click to upload</span> or drag and drop
                                </p>
                                <p class="text-xs text-white text-opacity-60">JSON or TXT files up to 10MB</p>
                            </div>
                        `;
                        lucide.createIcons();
                    }
                });
            });

            // Initialize Creativity Slider
            initializeCreativitySlider();
        }

        // Helper function to parse bulk prompts
        function parseBulkPrompts(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const bulkPrompts = [];
            
            for (const line of lines) {
                if (line.startsWith('*')) {
                    // Remove the asterisk and any extra whitespace
                    const prompt = line.substring(1).trim();
                    if (prompt.length > 0) {
                        bulkPrompts.push(prompt);
                    }
                }
            }
            
            return bulkPrompts;
        }

        // Helper function to check if text contains bulk prompts
        function hasBulkPrompts(text) {
            return text.split('\n').some(line => line.trim().startsWith('*'));
        }

        // Helper functions to get button values
        function getSelectedVariationsType() {
            const activeBtn = document.querySelector('.variations-type-btn.active');
            return activeBtn ? activeBtn.dataset.value : 'close';
        }

        function getSelectedVariationCount() {
            const activeBtn = document.querySelector('.variation-btn.active');
            return activeBtn ? parseInt(activeBtn.dataset.value) : 5;
        }

        function getSelectedCreativityLevel() {
            const thumb = document.getElementById('creativityThumb');
            return thumb ? parseInt(thumb.dataset.value) : 1;
        }

        function getSelectedDownloadMode() {
            return localStorage.getItem('downloadMode') || 'auto';
        }

        function getSelectedDownloadPrompts() {
            const savedValue = localStorage.getItem('downloadPrompts') || 'no';
            return savedValue === 'yes';
        }

        function getSelectedCustomPrompts() {
            const activeBtn = document.querySelector('.custom-prompts-btn.active');
            return activeBtn ? activeBtn.dataset.value === 'yes' : false;
        }

        // Creativity Slider Functions
        function initializeCreativitySlider() {
            const track = document.querySelector('.creativity-slider-track');
            const thumb = document.getElementById('creativityThumb');
            const fill = document.getElementById('creativityFill');
            const valueDisplay = document.getElementById('creativityValue');
            const markers = document.querySelectorAll('.creativity-marker');
            
            let isDragging = false;
            let currentValue = 1;
            
            function updateSlider(value) {
                currentValue = Math.max(1, Math.min(10, value));
                const percentage = ((currentValue - 1) / 9) * 100;
                
                thumb.style.left = `${percentage}%`;
                thumb.dataset.value = currentValue;
                fill.style.width = `${percentage}%`;
                valueDisplay.textContent = currentValue;
                
                // Update markers
                markers.forEach(marker => {
                    marker.classList.toggle('active', parseInt(marker.dataset.value) <= currentValue);
                });
            }
            
            function getValueFromPosition(clientX) {
                const rect = track.getBoundingClientRect();
                const percentage = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
                return Math.round(percentage * 9) + 1;
            }
            
            // Mouse events
            thumb.addEventListener('mousedown', (e) => {
                isDragging = true;
                thumb.classList.add('dragging');
                e.preventDefault();
            });
            
            track.addEventListener('click', (e) => {
                if (!isDragging) {
                    const value = getValueFromPosition(e.clientX);
                    updateSlider(value);
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const value = getValueFromPosition(e.clientX);
                    updateSlider(value);
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    thumb.classList.remove('dragging');
                }
            });
            
            // Touch events for mobile
            thumb.addEventListener('touchstart', (e) => {
                isDragging = true;
                thumb.classList.add('dragging');
                e.preventDefault();
            });
            
            document.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    const value = getValueFromPosition(touch.clientX);
                    updateSlider(value);
                    e.preventDefault();
                }
            });
            
            document.addEventListener('touchend', () => {
                if (isDragging) {
                    isDragging = false;
                    thumb.classList.remove('dragging');
                }
            });
            
            // Initialize with default value
            updateSlider(1);
        }

        // Animation Control Functions
        function activateGenerationAnimations() {
            const floatingBrowsers = document.getElementById('floatingBrowsers');
            if (floatingBrowsers) {
                floatingBrowsers.classList.add('generating');
            }
        }

        function deactivateGenerationAnimations() {
            const floatingBrowsers = document.getElementById('floatingBrowsers');
            if (floatingBrowsers) {
                floatingBrowsers.classList.remove('generating');
            }
            
            // Hide top progress bar
            const topProgressBar = document.getElementById('topProgressBar');
            if (topProgressBar) {
                topProgressBar.classList.add('hidden');
            }
        }

        // Fullscreen Viewer Functions
        function openFullscreenViewer(htmlContent, filename) {
            const viewer = document.getElementById('fullscreenViewer');
            const iframe = document.getElementById('fullscreenIframe');
            const title = document.getElementById('fullscreenTitle');
            
            title.textContent = filename.replace('.html', '');
            iframe.srcdoc = htmlContent;
            viewer.classList.add('active');
        }

        function closeFullscreenViewer() {
            const viewer = document.getElementById('fullscreenViewer');
            viewer.classList.remove('active');
        }

        // Generation Placeholder Functions
        function addNextDesignPlaceholder() {
            // Remove existing placeholder
            const existingPlaceholder = document.querySelector('.generating-placeholder');
            if (existingPlaceholder) {
                existingPlaceholder.remove();
            }
            
            const placeholder = document.createElement('div');
            placeholder.className = 'design-card generating-placeholder generating';
            placeholder.innerHTML = `
                <div class="design-card-header flex justify-between items-center">
                    <span class="text-xs font-medium text-white text-opacity-50">Generating...</span>
                    <div class="flex items-center space-x-1">
                        <div class="w-3 h-3 border border-aurora-cyan border-t-transparent rounded-full animate-spin opacity-60"></div>
                    </div>
                </div>
                <div class="preview-frame flex items-center justify-center" style="background: linear-gradient(to bottom right, rgba(116, 249, 255, 0.05), rgba(184, 106, 223, 0.05))">
                    <div class="text-center">
                        <i data-lucide="sparkles" class="w-8 h-8 text-white text-opacity-30 mx-auto mb-2 animate-pulse"></i>
                        <p class="text-xs text-white text-opacity-40">Creating design...</p>
                    </div>
                </div>
            `;
            
            designsGrid.appendChild(placeholder);
            lucide.createIcons();
        }

        // Initialize
        loadSettings();
        updateEmptyState();
        initializeButtonGroups();
        
        // Add download diagnostics
        function checkDownloadCapabilities() {
            const diagnostics = {
                secureContext: window.isSecureContext,
                protocol: location.protocol,
                hostname: location.hostname,
                userAgent: navigator.userAgent,
                blobSupport: typeof Blob !== 'undefined',
                createObjectURLSupport: typeof URL.createObjectURL !== 'undefined',
                downloadAttributeSupport: 'download' in document.createElement('a'),
                clipboardSupport: navigator.clipboard && typeof navigator.clipboard.writeText === 'function'
            };
            
            console.log('🔍 Download Diagnostics:', diagnostics);
            
            // Show warnings for potential issues
            if (!diagnostics.secureContext) {
                console.warn('⚠️ Not in secure context - downloads may be blocked');
                showToast('Downloads may be blocked. Try HTTPS or localhost.', 'warning');
            }
            
            if (!diagnostics.blobSupport) {
                console.error('❌ Blob API not supported');
                showToast('Browser does not support file downloads', 'error');
            }
            
            return diagnostics;
        }
        
        // Run diagnostics on page load
        setTimeout(checkDownloadCapabilities, 1000);
        
        // Fix: Ensure downloadAllBtn event listener is set up after initialization
        setTimeout(() => {
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            if (downloadAllBtn && !downloadAllBtn.hasAttribute('data-listener-attached')) {
                downloadAllBtn.addEventListener('click', downloadAllDesigns);
                downloadAllBtn.setAttribute('data-listener-attached', 'true');
                console.log('Download all button event listener attached');
            }
        }, 100);
        
        // Initialize multi-model functionality
        if (multiModelCheckbox) {
            // Set initial state
            isMultiModel = multiModelCheckbox.checked;
            
            // Load saved multi-model settings
            const savedMultiModel = localStorage.getItem('isMultiModel') === 'true';
            const savedSelectedModels = localStorage.getItem('selectedModels');
            
            if (savedMultiModel) {
                multiModelCheckbox.checked = true;
                isMultiModel = true;
                
                if (savedSelectedModels) {
                    try {
                        selectedModels = JSON.parse(savedSelectedModels);
                    } catch (e) {
                        selectedModels = [];
                    }
                }
                
                // Apply multi-model state
                modelSelectionContainer.classList.add('hidden');
                multiModelContainer.classList.remove('hidden');
                populateMultiModelList();
            }
        }

        // New Layout Functions
        function toggleMobileSidebar() {
            sidebar.classList.add('open');
            mobileOverlay.classList.remove('hidden');
        }

        function closeMobileSidebar() {
            sidebar.classList.remove('open');
            mobileOverlay.classList.add('hidden');
        }

        function updateEmptyState() {
            // Don't change state during generation - let showGenerationState handle it
            if (isGenerating) {
                return;
            }
            
            if (generatedDesigns.length === 0) {
                emptyState.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                resultsContainer.classList.remove('hidden');
                
                // Fix: Ensure downloadAllBtn event listener is properly set up when results become visible
                const downloadAllBtn = document.getElementById('downloadAllBtn');
                if (downloadAllBtn && !downloadAllBtn.hasAttribute('data-listener-attached')) {
                    downloadAllBtn.addEventListener('click', downloadAllDesigns);
                    downloadAllBtn.setAttribute('data-listener-attached', 'true');
                }
            }
        }

        function showGenerationState() {
            // Force show the empty state immediately
            emptyState.classList.remove('hidden');
            resultsContainer.classList.add('hidden');
            
            // Hide the landing page content but keep the floating browsers visible
            const welcomeContent = document.querySelector('.welcome-content-enhanced');
            if (welcomeContent) {
                welcomeContent.style.display = 'none';
            }
            
            // Activate generation animations on the floating browsers immediately
            activateGenerationAnimations();
            
            // Add a generation status overlay
            const existingOverlay = document.getElementById('generationOverlay');
            if (!existingOverlay) {
                const overlay = document.createElement('div');
                overlay.id = 'generationOverlay';
                overlay.className = 'absolute inset-0 flex items-center justify-center z-20';
                overlay.innerHTML = `
                    <div class="welcome-content-enhanced text-center">
                        <div class="empty-state-icon mb-6">
                            <i data-lucide="sparkles" class="w-20 h-20 sparkle-icon animate-pulse" style="color: var(--aurora-cyan)"></i>
                        </div>
                        <h2 class="text-3xl md:text-4xl welcome-title mb-4 text-center font-bold">
                            Generating Your Designs...
                        </h2>
                        <p class="text-lg text-center mb-6 text-white text-opacity-80 font-medium">
                            AI is crafting unique variations based on your prompt
                        </p>
                        <div class="flex items-center justify-center gap-3 text-white text-opacity-70">
                            <div class="w-2 h-2 bg-aurora-cyan rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                            <div class="w-2 h-2 bg-aurora-purple rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                            <div class="w-2 h-2 bg-aurora-pink rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                `;
                emptyState.appendChild(overlay);
                lucide.createIcons();
            }
        }

        function hideGenerationState() {
            // Show the welcome content again
            const welcomeContent = document.querySelector('.welcome-content-enhanced');
            if (welcomeContent) {
                welcomeContent.style.display = 'flex';
            }
            
            // Remove generation overlay
            const overlay = document.getElementById('generationOverlay');
            if (overlay) {
                overlay.remove();
            }
            
            // Deactivate generation animations
            deactivateGenerationAnimations();
        }

        // Handle window resize for responsive behavior
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('open');
                mobileOverlay.classList.add('hidden');
            }
        });

        // Helper functions
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlightDropzone() {
            fileDropzone.classList.add('active');
        }

        function unhighlightDropzone() {
            fileDropzone.classList.remove('active');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) {
                promptsFileInput.files = files;
                updateDropzoneUI(files[0]);
            }
        }

        function handleFileSelect() {
            if (promptsFileInput.files.length) {
                updateDropzoneUI(promptsFileInput.files[0]);
            }
        }

        function updateDropzoneUI(file) {
            const dropzoneContent = fileDropzone.querySelector('div');
            dropzoneContent.innerHTML = `
                <i data-lucide="file-text" class="w-8 h-8 text-indigo-500"></i>
                <p class="text-xs font-medium text-gray-700 truncate max-w-xs">${file.name}</p>
                <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
            `;
            lucide.createIcons();
        }

        function toggleApiKeyVisibilityHandler() {
            apiKeyVisible = !apiKeyVisible;
            apiKeyInput.type = apiKeyVisible ? 'text' : 'password';
            const icon = toggleApiKeyVisibility.querySelector('i');
            icon.setAttribute('data-lucide', apiKeyVisible ? 'eye-off' : 'eye');
            lucide.createIcons();
        }

        function loadSettings() {
            const savedApiKey = localStorage.getItem('openRouterApiKey');
            const savedModel = localStorage.getItem('selectedAiModel');
            const savedDownloadMode = localStorage.getItem('downloadMode');
            const savedDownloadPrompts = localStorage.getItem('downloadPrompts');
            const savedMultiModel = localStorage.getItem('isMultiModel') === 'true';
            const savedSelectedModels = localStorage.getItem('selectedModels');
            
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
            
            if (savedModel) {
                modalAiModel.value = savedModel;
                mainAiModel.value = savedModel;
            }

            // Load download settings
            const downloadModeSelect = document.getElementById('downloadModeSelect');
            const downloadPromptsSelect = document.getElementById('downloadPromptsSelect');
            
            if (savedDownloadMode && downloadModeSelect) {
                downloadModeSelect.value = savedDownloadMode;
            }

            if (savedDownloadPrompts && downloadPromptsSelect) {
                downloadPromptsSelect.value = savedDownloadPrompts;
            }

            // Load multi-model settings
            if (multiModelCheckbox) {
                multiModelCheckbox.checked = savedMultiModel;
                isMultiModel = savedMultiModel;
                
                if (savedSelectedModels) {
                    try {
                        selectedModels = JSON.parse(savedSelectedModels);
                    } catch (e) {
                        selectedModels = [];
                    }
                }
                
                // Apply multi-model state
                if (isMultiModel) {
                    modelSelectionContainer.classList.add('hidden');
                    multiModelContainer.classList.remove('hidden');
                    populateMultiModelList();
                } else {
                    modelSelectionContainer.classList.remove('hidden');
                    multiModelContainer.classList.add('hidden');
                }
            }
        }

        function saveSettings() {
            const apiKey = apiKeyInput.value.trim();
            const selectedModel = modalAiModel.value;
            const downloadModeSelect = document.getElementById('downloadModeSelect');
            const downloadPromptsSelect = document.getElementById('downloadPromptsSelect');
            const downloadMode = downloadModeSelect ? downloadModeSelect.value : 'auto';
            const downloadPrompts = downloadPromptsSelect ? downloadPromptsSelect.value : 'no';
            
            if (!apiKey) {
                showToast('Please enter your OpenRouter API key', 'error');
                return;
            }

            // Validate multi-model selection
            if (isMultiModel && selectedModels.length === 0) {
                showToast('Please select at least one model for multi-model generation', 'error');
                return;
            }
            
            localStorage.setItem('openRouterApiKey', apiKey);
            localStorage.setItem('selectedAiModel', selectedModel);
            localStorage.setItem('downloadMode', downloadMode);
            localStorage.setItem('downloadPrompts', downloadPrompts);
            localStorage.setItem('isMultiModel', isMultiModel.toString());
            localStorage.setItem('selectedModels', JSON.stringify(selectedModels));
            
            mainAiModel.value = selectedModel;
            
            apiSettingsModal.classList.add('hidden');
            showToast('Settings saved successfully!', 'success');
        }



        // Generation functions
        async function startGeneration() {
            const mainPromptText = mainPrompt.value.trim();
            const promptModifierText = promptModifier.value.trim();
            const variationsType = getSelectedVariationsType();
            const variationCount = getSelectedVariationCount();
            const downloadMode = getSelectedDownloadMode();
            const useCustomPrompts = getSelectedCustomPrompts();
            const creativityLevel = getSelectedCreativityLevel();
            const downloadPrompts = getSelectedDownloadPrompts();
            const apiKey = localStorage.getItem('openRouterApiKey');
            const model = mainAiModel.value;

            if (!apiKey) {
                showToast('Please set your OpenRouter API key in the settings first.', 'error');
                return;
            }

            if (!mainPromptText && !useCustomPrompts) {
                showToast('Please enter a main prompt or provide custom prompts.', 'error');
                return;
            }

            // Check for bulk prompts in main prompt field
            const isBulkPrompts = !useCustomPrompts && hasBulkPrompts(mainPromptText);
            let bulkPromptsList = [];
            
            if (isBulkPrompts) {
                bulkPromptsList = parseBulkPrompts(mainPromptText);
                if (bulkPromptsList.length === 0) {
                    showToast('No valid bulk prompts found. Please ensure each prompt starts with "*".', 'error');
                    return;
                }
                showToast(`Detected ${bulkPromptsList.length} bulk prompts. This will override variation count.`, 'info');
            }

            // Disable generate button during generation and add animation
            generateBtn.disabled = true;
            generateBtn.classList.add('generating');
            generateBtn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i><span class="text-sm">Generating...</span>';
            lucide.createIcons();

            // Prepare prompts
            if (useCustomPrompts) {
                const fileInput = document.getElementById('promptsFile');
                const customPromptsText = document.getElementById('customPrompts').value.trim();
                
                if (fileInput.files.length > 0) {
                    try {
                        const file = fileInput.files[0];
                        if (file.size > 10 * 1024 * 1024) {
                            showToast('File size exceeds 10MB limit', 'error');
                            resetGenerateButton();
                            return;
                        }
                        const fileContent = await readFileAsText(file);
                        prompts = parsePromptsFromFile(fileContent);
                    } catch (error) {
                        console.error('Error reading prompts file:', error);
                        showToast('Error reading prompts file. Please try again.', 'error');
                        resetGenerateButton();
                        return;
                    }
                } else if (customPromptsText) {
                    prompts = customPromptsText.split('\n').filter(p => p.trim());
                } else {
                    showToast('Please provide custom prompts either by uploading a file or pasting them in the text area.', 'error');
                    resetGenerateButton();
                    return;
                }
            } else if (isBulkPrompts) {
                // Handle bulk prompts - apply prompt modifier to each bulk prompt
                if (promptModifierText) {
                    prompts = bulkPromptsList.map(prompt => `${prompt} ${promptModifierText}`);
                    showToast(`Applied prompt modifier to ${bulkPromptsList.length} bulk prompts`, 'info');
                } else {
                    prompts = [...bulkPromptsList];
                }
                
                showToast(`Processing ${prompts.length} bulk prompts...`, 'info');
                
                // Check if user wants to download bulk prompts
                if (downloadPrompts) {
                    showToast('Downloading bulk prompts file...', 'info');
                    setTimeout(() => {
                        downloadPromptsFile(prompts, 'bulk-prompts-list');
                    }, 500);
                }
            } else {
                try {
                    showToast(`Generating ${variationCount} ${variationsType} variations (creativity: ${creativityLevel}/10)...`, 'info');
                    const response = await generatePromptVariations(mainPromptText, variationCount, apiKey, model, creativityLevel, variationsType, promptModifierText);
                    prompts = response;
                    
                    // Debug logging to track enhanced prompts
                    console.log('Enhancement Settings:', {
                        original: mainPromptText,
                        requestedCount: variationCount,
                        enhancementType: variationsType,
                        creativityLevel: creativityLevel,
                        model: model
                    });
                    console.log('Enhanced prompts:', prompts);
                    
                    // Show user detailed feedback
                    const enhancementTypeText = variationsType === 'close' ? 'detailed' : 'diverse';
                    showToast(`Generated ${prompts.length} ${enhancementTypeText} enhanced prompts based on: "${mainPromptText.substring(0, 50)}..."`, 'success');
                    
                    // Check if user wants to download prompts
                    if (downloadPrompts) {
                        showToast('Downloading prompts file...', 'info');
                        setTimeout(() => {
                            downloadPromptsFile(prompts, mainPromptText);
                        }, 500);
                    }
                } catch (error) {
                    console.error('Error generating prompt variations:', error);
                    showToast('Failed to generate prompt variations. Please try again.', 'error');
                    resetGenerateButton();
                    return;
                }
            }

            if (prompts.length === 0) {
                showToast('No valid prompts to generate from.', 'error');
                resetGenerateButton();
                return;
            }

            // Apply prompt modifier to custom prompts if provided
            if (useCustomPrompts && promptModifierText) {
                prompts = prompts.map(prompt => `${prompt} ${promptModifierText}`);
                showToast(`Applied prompt modifier to ${prompts.length} custom prompts`, 'info');
            }

            // Handle download prompts for custom prompts case
            if (useCustomPrompts && downloadPrompts) {
                const customPromptSource = promptsFileInput.files.length > 0 ? 'uploaded-file' : 'custom-input';
                showToast('Downloading custom prompts file...', 'info');
                setTimeout(() => {
                    downloadPromptsFile(prompts, `custom-prompts-${customPromptSource}`);
                }, 500);
            }

            // Initialize generation state
            isGenerating = true;
            isPaused = false;
            currentIndex = 0;
            generatedDesigns = [];
            designsGrid.innerHTML = '';
            generationQueue = [...prompts];
            
            // Show animated generation state
            showGenerationState();
            
            // Get selected models for generation
            const modelsToUse = getSelectedModels();
            const totalGenerations = isMultiModel ? prompts.length * modelsToUse.length : prompts.length;
            
            // Determine the source of prompts for logging
            let promptSource = '';
            if (useCustomPrompts) {
                promptSource = 'custom prompts';
            } else if (isBulkPrompts) {
                promptSource = 'bulk prompts';
            } else {
                promptSource = `${variationsType} variations`;
            }
            
            // Show progress
            if (progressContainer) progressContainer.classList.remove('hidden');
            if (headerProgressContainer) headerProgressContainer.classList.remove('hidden');
            if (completedCount) completedCount.textContent = '0';
            if (totalCount) totalCount.textContent = totalGenerations;
            if (headerCompletedCount) headerCompletedCount.textContent = '0';
            if (headerTotalCount) headerTotalCount.textContent = totalGenerations;
            if (progressFill) progressFill.style.width = '0%';
            if (statusText) {
                statusText.textContent = isMultiModel ? `Generating ${promptSource} with ${modelsToUse.length} models...` : `Generating ${promptSource}...`;
                statusText.className = 'font-medium status-generating';
            }
            if (headerStatusText) {
                headerStatusText.textContent = isMultiModel ? `Multi-Model (${modelsToUse.length})` : `${promptSource}`;
                headerStatusText.className = 'text-sm font-medium status-generating';
            }
            
            // Show multi-model info
            if (isMultiModel) {
                showToast(`Multi-model generation: ${modelsToUse.length} models × ${prompts.length} prompts = ${totalGenerations} designs`, 'info');
            }
            
            // Show top progress bar
            const topProgressBar = document.getElementById('topProgressBar');
            topProgressBar.classList.remove('hidden');
            
            // Start processing
            processNextPrompt();
        }

        function resetGenerateButton() {
            generateBtn.disabled = false;
            generateBtn.classList.remove('generating');
            generateBtn.innerHTML = '<i data-lucide="sparkles" class="w-4 h-4"></i><span class="text-sm">Generate Designs</span>';
            lucide.createIcons();
        }

        async function processNextPrompt() {
            if (!isGenerating || isPaused || currentIndex >= prompts.length) {
                if (currentIndex >= prompts.length) {
                    // Generation complete
                    isGenerating = false;
                    if (statusText) {
                        statusText.textContent = 'Generation complete!';
                        statusText.className = 'font-medium status-complete';
                    }
                    if (headerStatusText) {
                        headerStatusText.textContent = 'Complete!';
                        headerStatusText.className = 'text-sm font-medium status-complete';
                    }
                    if (currentPromptDisplay) currentPromptDisplay.classList.add('hidden');
                    showToast('All designs generated successfully!', 'success');
                    resetGenerateButton();
                    hideGenerationState();
                    updateEmptyState();
                }
                return;
            }

            const currentPrompt = prompts[currentIndex];
            const apiKey = localStorage.getItem('openRouterApiKey');
            const model = mainAiModel.value;
            const downloadMode = getSelectedDownloadMode();

            try {
                if (statusText) statusText.textContent = `Generating design ${currentIndex + 1} of ${prompts.length}`;
                if (headerStatusText) headerStatusText.textContent = `Generating ${currentIndex + 1}/${prompts.length}`;
                
                // Show current prompt in UI
                if (currentPromptText) {
                    currentPromptText.textContent = currentPrompt.length > 100 ? 
                        currentPrompt.substring(0, 100) + '...' : currentPrompt;
                }
                if (currentPromptDisplay) currentPromptDisplay.classList.remove('hidden');
                
                // Debug: Log the current prompt being processed
                console.log(`Processing prompt ${currentIndex + 1}:`, currentPrompt);
                
                const htmlContent = await generateHtmlDesign(currentPrompt, apiKey, model, getSelectedCreativityLevel());
                
                // Create design preview
                const designId = `design-${Date.now()}-${currentIndex}`;
                const filename = generateFilename(currentPrompt, htmlContent);
                
                const designCard = document.createElement('div');
                designCard.className = 'design-card';
                designCard.innerHTML = `
                    <div class="design-card-header flex justify-between items-center">
                        <span class="text-xs font-medium text-white truncate flex-1" title="${filename}">${filename}</span>
                        <div class="flex items-center space-x-1">
                            <button class="glass-button p-1.5 rounded open-full" title="Open in new window">
                                <i data-lucide="external-link" class="w-3 h-3 aurora-icon"></i>
                            </button>
                            <button class="glass-button p-1.5 rounded fullscreen-btn" title="Full Screen" style="color: var(--aurora-purple);">
                                <i data-lucide="maximize-2" class="w-3 h-3 aurora-icon"></i>
                            </button>
                            <button class="glass-button p-1.5 rounded download-btn" title="Download" style="color: var(--aurora-cyan);">
                                <i data-lucide="download" class="w-3 h-3 aurora-icon"></i>
                            </button>
                            <button class="glass-button p-1.5 rounded reject-btn" title="Reject" style="color: var(--aurora-pink);">
                                <i data-lucide="trash-2" class="w-3 h-3 aurora-icon"></i>
                            </button>
                        </div>
                    </div>
                    <div class="preview-frame">
                        <iframe class="w-full h-full" srcdoc="${escapeHtml(htmlContent)}"></iframe>
                    </div>
                `;
                
                designsGrid.appendChild(designCard);
                lucide.createIcons();
                
                // Remove generation overlay when first design appears
                if (currentIndex === 1) {
                    const overlay = document.getElementById('generationOverlay');
                    if (overlay) {
                        overlay.remove();
                    }
                    // Switch to results view but keep generation animations
                    emptyState.classList.add('hidden');
                    resultsContainer.classList.remove('hidden');
                    // Keep generation animations active until completion
                }
                
                // Add generation animation to the next design slot if available
                if (currentIndex + 1 < prompts.length) {
                    addNextDesignPlaceholder();
                }
                
                // Add event listeners with defensive programming
                const openFullBtn = designCard.querySelector('.open-full');
                const fullscreenBtn = designCard.querySelector('.fullscreen-btn');
                const downloadBtn = designCard.querySelector('.download-btn');
                const rejectBtn = designCard.querySelector('.reject-btn');
                
                if (openFullBtn) {
                    openFullBtn.addEventListener('click', () => {
                        openDesignInNewWindow(htmlContent, filename);
                    });
                }
                
                if (fullscreenBtn) {
                    fullscreenBtn.addEventListener('click', () => {
                        openFullscreenViewer(htmlContent, filename);
                    });
                }
                
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', () => {
                        downloadDesign(htmlContent, filename);
                    });
                }
                
                if (rejectBtn) {
                    rejectBtn.addEventListener('click', () => {
                        designCard.remove();
                        generatedDesigns = generatedDesigns.filter(d => d.id !== designId);
                        updateEmptyState();
                    });
                }
                
                // Store design data
                generatedDesigns.push({
                    id: designId,
                    prompt: currentPrompt,
                    html: htmlContent,
                    filename: filename
                });
                
                // Auto download if enabled
                if (downloadMode === 'auto') {
                    downloadDesign(htmlContent, filename);
                }
                
                // Update progress
                currentIndex++;
                if (completedCount) completedCount.textContent = currentIndex;
                if (headerCompletedCount) headerCompletedCount.textContent = currentIndex;
                if (progressFill) progressFill.style.width = `${(currentIndex / prompts.length) * 100}%`;
                
                // Update top progress bar
                const topProgressFill = document.querySelector('.top-progress-fill');
                if (topProgressFill) {
                    topProgressFill.style.width = `${(currentIndex / prompts.length) * 100}%`;
                }
                
                // Remove previous generation placeholder
                const prevPlaceholder = document.querySelector('.generating-placeholder');
                if (prevPlaceholder) {
                    prevPlaceholder.remove();
                }
                
                updateEmptyState();
                
                // Process next prompt with delay to prevent rate limiting
                setTimeout(processNextPrompt, 1500);
            } catch (error) {
                console.error('Error generating design:', error);
                currentIndex++;
                completedCount.textContent = currentIndex;
                progressFill.style.width = `${(currentIndex / prompts.length) * 100}%`;
                setTimeout(processNextPrompt, 1500);
            }
        }

        function pauseGeneration() {
            if (!isGenerating) return;
            
            isPaused = true;
            if (pauseBtn) pauseBtn.classList.add('hidden');
            if (resumeBtn) resumeBtn.classList.remove('hidden');
            if (headerPauseBtn) headerPauseBtn.classList.add('hidden');
            if (headerResumeBtn) headerResumeBtn.classList.remove('hidden');
            if (statusText) {
                statusText.textContent = 'Paused';
                statusText.className = 'font-medium status-paused';
            }
            if (headerStatusText) {
                headerStatusText.textContent = 'Paused';
                headerStatusText.className = 'text-sm font-medium status-paused';
            }
            showToast('Generation paused', 'warning');
        }

        function resumeGeneration() {
            if (!isGenerating) return;
            
            isPaused = false;
            if (pauseBtn) pauseBtn.classList.remove('hidden');
            if (resumeBtn) resumeBtn.classList.add('hidden');
            if (headerPauseBtn) headerPauseBtn.classList.remove('hidden');
            if (headerResumeBtn) headerResumeBtn.classList.add('hidden');
            if (statusText) {
                statusText.textContent = 'Generating...';
                statusText.className = 'font-medium status-generating';
            }
            if (headerStatusText) {
                headerStatusText.textContent = 'Generating...';
                headerStatusText.className = 'text-sm font-medium status-generating';
            }
            showToast('Generation resumed', 'info');
            processNextPrompt();
        }

        function stopGeneration() {
            isGenerating = false;
            isPaused = false;
            if (statusText) {
                statusText.textContent = 'Stopped';
                statusText.className = 'font-medium status-error';
            }
            if (headerStatusText) {
                headerStatusText.textContent = 'Stopped';
                headerStatusText.className = 'text-sm font-medium status-error';
            }
            if (currentPromptDisplay) currentPromptDisplay.classList.add('hidden');
            showToast('Generation stopped', 'error');
            resetGenerateButton();
            hideGenerationState();
            updateEmptyState();
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function extractMetaTitle(htmlContent) {
            try {
                // Extract title from HTML content
                const titleMatch = htmlContent.match(/<title[^>]*>(.*?)<\/title>/i);
                if (titleMatch && titleMatch[1]) {
                    let title = titleMatch[1].trim();
                    
                    // Clean up common unwanted text
                    title = title
                        .replace(/\s*-\s*Home\s*$/i, '')
                        .replace(/\s*-\s*Website\s*$/i, '')
                        .replace(/\s*-\s*Official\s*$/i, '')
                        .replace(/\s*-\s*Main\s*$/i, '')
                        .replace(/\s*Home\s*Page\s*$/i, '')
                        .replace(/\s*Website\s*$/i, '')
                        .replace(/\s*Official\s*$/i, '')
                        .replace(/\s*Page\s*$/i, '')
                        .trim();
                    
                    if (title.length > 0) {
                        return title;
                    }
                }
                return null;
            } catch (error) {
                console.log('Error extracting meta title:', error);
                return null;
            }
        }

        function generateFilename(prompt, htmlContent = null) {
            let baseName = '';
            
            // Try to extract meta title from HTML content first
            if (htmlContent) {
                const metaTitle = extractMetaTitle(htmlContent);
                if (metaTitle) {
                    baseName = metaTitle;
                    console.log(`📄 Using meta title for filename: "${metaTitle}"`);
                }
            }
            
            // Fallback to prompt-based filename if no meta title found
            if (!baseName) {
                baseName = prompt;
                console.log(`📝 Using prompt for filename (no meta title found)`);
            }
            
            // Sanitize the base name
            let sanitized = baseName
                .toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .substring(0, 50) // Increased length to accommodate product names
                .replace(/-+$/, '');
            
            // Remove common prefixes and suffixes
            sanitized = sanitized
                .replace(/^design-/, '')
                .replace(/^website-/, '')
                .replace(/^page-/, '')
                .replace(/^a-/, '')
                .replace(/^an-/, '')
                .replace(/^the-/, '')
                .replace(/-website$/, '')
                .replace(/-page$/, '')
                .replace(/-home$/, '');
            
            // Ensure we have a valid name
            if (!sanitized || sanitized.length < 3) {
                sanitized = 'design';
            }
            
            // Generate 3 random digits for uniqueness
            const randomDigits = Math.floor(Math.random() * 900) + 100;
            
            const finalFilename = `${sanitized}-${randomDigits}.html`;
            console.log(`📁 Generated filename: "${finalFilename}"`);
            
            return finalFilename;
        }

        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = event => resolve(event.target.result);
                reader.onerror = error => reject(error);
                reader.readAsText(file);
            });
        }

        function parsePromptsFromFile(content) {
            try {
                // Try to parse as JSON
                const json = JSON.parse(content);
                if (Array.isArray(json)) {
                    return json.filter(p => typeof p === 'string' && p.trim());
                }
                if (typeof json === 'object' && json.prompts) {
                    return json.prompts.filter(p => typeof p === 'string' && p.trim());
                }
                return [content]; // Fallback to using the whole content as one prompt
            } catch (e) {
                // Not JSON, treat as plain text
                return content.split('\n').filter(p => p.trim());
            }
        }

        function downloadDesign(htmlContent, filename) {
            try {
                console.log('Downloading design:', filename, 'Content length:', htmlContent.length);
                
                if (!htmlContent || htmlContent.length === 0) {
                    console.error('No HTML content to download');
                    showToast('No content to download', 'error');
                    return;
                }
                
                // Method 1: Standard blob download
                try {
                    const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    
                    // Create download link
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.style.display = 'none';
                    
                    // Add to DOM, click, and remove
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    // Clean up URL after a delay
                    setTimeout(() => {
                        try {
                            URL.revokeObjectURL(url);
                        } catch (e) {
                            console.warn('Error revoking URL:', e);
                        }
                    }, 1000);
                    
                    console.log('Download completed successfully:', filename);
                    return;
                } catch (blobError) {
                    console.warn('Blob download failed, trying fallback method:', blobError);
                }
                
                // Method 2: Fallback - Data URL download
                try {
                    const dataUrl = 'data:text/html;charset=utf-8,' + encodeURIComponent(htmlContent);
                    const a = document.createElement('a');
                    a.href = dataUrl;
                    a.download = filename;
                    a.style.display = 'none';
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    console.log('Download completed with fallback method:', filename);
                    return;
                } catch (dataUrlError) {
                    console.warn('Data URL download failed:', dataUrlError);
                }
                
                // Method 3: Final fallback - Open in new window for manual save
                console.warn('All download methods failed, opening in new window for manual save');
                showToast('Download failed. Opening in new window for manual save.', 'warning');
                openDesignInNewWindow(htmlContent, filename);
                
            } catch (error) {
                console.error('Error downloading design:', error);
                showToast('Failed to download design. Try opening in new window.', 'error');
                
                // Last resort: try to open in new window
                try {
                    openDesignInNewWindow(htmlContent, filename);
                } catch (openError) {
                    console.error('Failed to open in new window as well:', openError);
                }
            }
        }

        function downloadPromptsFile(prompts, originalPrompt) {
            try {
                // Create content for the prompts file
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const filename = `prompts-${originalPrompt.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-').substring(0, 30)}-${timestamp}.txt`;
                
                let content = `Generated Prompt Variations\n`;
                content += `Generated on: ${new Date().toLocaleString()}\n`;
                content += `Original Prompt: ${originalPrompt}\n`;
                content += `Total Variations: ${prompts.length}\n`;
                content += `${'='.repeat(80)}\n\n`;
                
                prompts.forEach((prompt, index) => {
                    content += `${index + 1}. ${prompt}\n\n`;
                });
                
                content += `${'='.repeat(80)}\n`;
                content += `End of Generated Variations\n`;
                
                // Method 1: Standard blob download
                try {
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.style.display = 'none';
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => {
                        try {
                            URL.revokeObjectURL(url);
                        } catch (e) {
                            console.warn('Error revoking URL:', e);
                        }
                    }, 1000);
                    
                    showToast(`Prompts saved as ${filename}`, 'success');
                    return;
                } catch (blobError) {
                    console.warn('Blob download failed, trying fallback method:', blobError);
                }
                
                // Method 2: Fallback - Data URL download
                try {
                    const dataUrl = 'data:text/plain;charset=utf-8,' + encodeURIComponent(content);
                    const a = document.createElement('a');
                    a.href = dataUrl;
                    a.download = filename;
                    a.style.display = 'none';
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    showToast(`Prompts saved as ${filename} (fallback method)`, 'success');
                    return;
                } catch (dataUrlError) {
                    console.warn('Data URL download failed:', dataUrlError);
                }
                
                // Method 3: Final fallback - Copy to clipboard
                console.warn('All download methods failed, copying to clipboard');
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(content).then(() => {
                        showToast('Download failed. Content copied to clipboard.', 'warning');
                    }).catch(() => {
                        showToast('Download failed. Please copy content manually.', 'error');
                    });
                } else {
                    showToast('Download failed. Please copy content manually.', 'error');
                }
                
            } catch (error) {
                console.error('Error downloading prompts:', error);
                showToast('Failed to download prompts', 'error');
            }
        }

        function openDesignInNewWindow(htmlContent, filename) {
            try {
                console.log('Opening design in new window:', filename);
                
                if (!htmlContent || htmlContent.length === 0) {
                    console.error('No HTML content to open');
                    showToast('No content to open', 'error');
                    return;
                }
                
                const win = window.open('', '_blank');
                if (!win) {
                    console.error('Failed to open new window (popup blocked?)');
                    showToast('Popup blocked. Please allow popups for this site.', 'error');
                    return;
                }
                
                win.document.write(htmlContent);
                win.document.title = filename.replace('.html', '');
                win.document.close();
                
                console.log('Design opened successfully in new window');
            } catch (error) {
                console.error('Error opening design in new window:', error);
                showToast('Failed to open design in new window', 'error');
            }
        }

        function downloadAllDesigns() {
            console.log('Download all designs called. Total designs:', generatedDesigns.length);
            
            if (generatedDesigns.length === 0) {
                showToast('No designs to download', 'warning');
                return;
            }
            
            // Check if we're in a secure context (HTTPS or localhost)
            const isSecureContext = window.isSecureContext || location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            console.log('Secure context:', isSecureContext, 'Protocol:', location.protocol, 'Hostname:', location.hostname);
            
            if (!isSecureContext) {
                console.warn('Not in secure context - downloads may be blocked');
                showToast('Downloads may be blocked in non-secure context. Try HTTPS.', 'warning');
            }
            
            // For many designs, use staggered downloads to avoid overwhelming the browser
            if (generatedDesigns.length > 5) {
                showToast(`Preparing download for ${generatedDesigns.length} designs...`, 'info');
                
                let successCount = 0;
                let failCount = 0;
                
                const downloadNext = (index) => {
                    if (index >= generatedDesigns.length) {
                        // All downloads attempted
                        const message = `Downloaded ${successCount} of ${generatedDesigns.length} designs`;
                        showToast(message, successCount > 0 ? 'success' : 'error');
                        return;
                    }
                    
                    const design = generatedDesigns[index];
                    try {
                        downloadDesign(design.html, design.filename);
                        successCount++;
                    } catch (error) {
                        console.error(`Failed to download design ${index + 1}:`, error);
                        failCount++;
                    }
                    
                    // Download next design after delay
                    setTimeout(() => downloadNext(index + 1), 500);
                };
                
                // Start the download sequence
                setTimeout(() => downloadNext(0), 500);
            } else {
                // For fewer designs, download them all
                let successCount = 0;
                generatedDesigns.forEach((design, index) => {
                    try {
                        setTimeout(() => {
                            downloadDesign(design.html, design.filename);
                            successCount++;
                        }, index * 200);
                    } catch (error) {
                        console.error(`Failed to download design ${index + 1}:`, error);
                    }
                });
                
                setTimeout(() => {
                    showToast(`Downloaded ${successCount} of ${generatedDesigns.length} designs`, 'success');
                }, generatedDesigns.length * 200 + 500);
            }
        }

        function showToast(message, type = 'info') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            const colors = {
                info: '',
                success: '',
                warning: '',
                error: ''
            };
            
            const textColors = {
                info: 'var(--aurora-cyan)',
                success: '#4ade80',
                warning: '#fbbf24',
                error: 'var(--aurora-pink)'
            };
            
            const icons = {
                info: 'info',
                success: 'check-circle-2',
                warning: 'alert-triangle',
                error: 'x-circle'
            };
            
            const toast = document.createElement('div');
            toast.className = 'glass-card fixed bottom-6 right-6 px-4 py-3 flex items-center gap-3 z-50 fade-up';
            toast.style.borderColor = textColors[type];
            toast.innerHTML = `
                <i data-lucide="${icons[type]}" class="w-5 h-5 aurora-icon" style="color: ${textColors[type]}"></i>
                <span class="text-sm font-medium text-white">${message}</span>
            `;
            
            document.body.appendChild(toast);
            lucide.createIcons();
            
            // Auto-remove after delay
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Simple validation function (much cleaner)
        function validatePromptVariation(original, variation) {
            if (!variation || variation.length < 30) return false;
            
            // Check for meta-text
            const hasMetaText = /^(here are|i can|here's|these are|the variations)/i.test(variation.trim());
            if (hasMetaText) return false;
            
            // Simple check: variation should contain some words from original or be long enough to be an enhancement
            const originalWords = original.toLowerCase().split(/\s+/).filter(w => w.length > 3);
            const variationLower = variation.toLowerCase();
            const hasOverlap = originalWords.some(word => variationLower.includes(word));
            
            return hasOverlap || variation.length > 100;
        }

        // API functions - GUARANTEED user prompt preservation (simplified and reliable)
        async function generatePromptVariations(mainPrompt, count, apiKey, model, creativityLevel = 1, variationsType = 'close', promptModifier = '') {
            console.log(`🔄 Generating ${count} variations for: "${mainPrompt}"${promptModifier ? ` with modifier: "${promptModifier}"` : ''}`);
            
            // Calculate temperature based on creativity level
            const temperature = Math.min(1.2, Math.max(0.2, (creativityLevel - 1) * 0.11 + 0.3));
            
            // ✅ GUARANTEED APPROACH: Generate enhancement details with creativity and variation control
            
            // Define creativity level descriptions
            const creativityLevels = {
                1: { desc: "very conservative and traditional", approach: "stick to proven, standard web design patterns" },
                2: { desc: "mostly conservative with minor variations", approach: "use established patterns with small creative touches" },
                3: { desc: "balanced traditional approach", approach: "combine standard layouts with some modern elements" },
                4: { desc: "moderately creative", approach: "mix traditional and modern design approaches" },
                5: { desc: "balanced creativity", approach: "equal blend of traditional and innovative design elements" },
                6: { desc: "creatively forward", approach: "favor modern and innovative design patterns" },
                7: { desc: "quite creative and modern", approach: "prioritize contemporary design with creative layouts" },
                8: { desc: "very creative and experimental", approach: "use bold, innovative design approaches" },
                9: { desc: "highly experimental", approach: "explore cutting-edge design trends and patterns" },
                10: { desc: "maximally creative and avant-garde", approach: "push design boundaries with experimental concepts" }
            };
            
            const currentCreativity = creativityLevels[creativityLevel] || creativityLevels[5];
            
            const enhancementInstructions = variationsType === 'close' ? 
                `Generate ${count} CLOSE VARIATIONS - enhancement details that maintain similar design philosophy but with different implementation details:

🎯 VARIATION TYPE: Close/Similar Variations
🎨 CREATIVITY LEVEL: ${creativityLevel}/10 (${currentCreativity.desc})
📐 APPROACH: ${currentCreativity.approach}

CLOSE VARIATION REQUIREMENTS:
- Keep consistent design philosophy and overall aesthetic
- Vary specific sections, layouts, and component arrangements  
- Use different but harmonious color schemes and typography
- Include different UI components that serve similar purposes
- Maintain the same target audience and professional level
- Focus on implementation variety, not conceptual changes

CREATIVITY GUIDANCE FOR LEVEL ${creativityLevel}:
${currentCreativity.approach.charAt(0).toUpperCase() + currentCreativity.approach.slice(1)}` :
                `Generate ${count} UNIQUE VARIATIONS - enhancement details exploring diverse design approaches and philosophies:

🎯 VARIATION TYPE: Unique/Diverse Variations  
🎨 CREATIVITY LEVEL: ${creativityLevel}/10 (${currentCreativity.desc})
📐 APPROACH: ${currentCreativity.approach}

UNIQUE VARIATION REQUIREMENTS:
- Explore completely different design philosophies (minimalist, bold, corporate, artistic, etc.)
- Use dramatically different visual aesthetics and layout approaches
- Implement diverse color schemes, typography styles, and UI patterns
- Include varied interaction patterns and animation approaches  
- Target different aspects of user experience and engagement
- Create distinct personality and mood for each variation

CREATIVITY GUIDANCE FOR LEVEL ${creativityLevel}:
${currentCreativity.approach.charAt(0).toUpperCase() + currentCreativity.approach.slice(1)}`;

            const messages = [
                {
                    role: "system", 
                    content: `You are a web design expert. Generate enhancement details that will be added to design prompts. 

CRITICAL: Focus ONLY on enhancement details, not complete prompts. Your creativity level is ${creativityLevel}/10 (${currentCreativity.desc}), so ${currentCreativity.approach}.`
                },
                {
                    role: "user",
                    content: `${enhancementInstructions}

FORMAT REQUIREMENTS:
- Response must be numbered enhancement details only
- Each line: "1. featuring [specific details based on creativity level ${creativityLevel}]"
- Include specific sections, layouts, colors, typography, and interactions
- Match the ${variationsType} variation type and creativity level ${creativityLevel}

Generate exactly ${count} enhancement options now:`
                }
            ];

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Bulk Design Generator'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        temperature: temperature,
                        max_tokens: 80000,
                        top_p: 0.9
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}: ${await response.text()}`);
                }

                const data = await response.json();
                const enhancementsText = data.choices[0].message.content;
                
                console.log('🔍 AI-generated enhancements:', enhancementsText);
                console.log(`🎯 Using variation type: "${variationsType}" with creativity level ${creativityLevel}`);

                // Parse enhancement details
                let enhancements = [];
                const lines = enhancementsText.split('\n').map(line => line.trim());
                
                for (const line of lines) {
                    if (line.match(/^\d+\./)) {
                        const cleaned = line.replace(/^\d+\.\s*/, '').trim();
                        if (cleaned.length > 10) {
                            enhancements.push(cleaned);
                        }
                    }
                }

                console.log('📋 Parsed enhancements:', enhancements);

                // ✅ GUARANTEE: Manually combine original prompt with enhancements
                const guaranteedVariations = [];
                
                // Create base prompt with modifier if provided
                const basePrompt = promptModifier ? `${mainPrompt} ${promptModifier}` : mainPrompt;
                
                // Always start with the original as first variation with basic enhancement
                guaranteedVariations.push(`${basePrompt} - Create a comprehensive modern website featuring hero section with compelling visuals, navigation menu, detailed content sections, testimonials, contact information, and responsive design with professional typography and smooth animations`);

                // Combine original with each enhancement
                enhancements.forEach((enhancement, index) => {
                    if (guaranteedVariations.length < count) {
                        // Ensure enhancement starts properly
                        const cleanedEnhancement = enhancement.startsWith('featuring') ? enhancement : `featuring ${enhancement}`;
                        guaranteedVariations.push(`${basePrompt} - Create a modern website ${cleanedEnhancement}`);
                    }
                });

                // If AI didn't provide enough enhancements, create variation-type aware fallback variations
                if (guaranteedVariations.length < count) {
                    console.log(`⚠️  Using fallback variations for "${variationsType}" type (needed ${count - guaranteedVariations.length} more)`);
                }
                while (guaranteedVariations.length < count) {
                    const fallbackIndex = guaranteedVariations.length - 1;
                    
                    let fallbackEnhancements;
                    
                    if (variationsType === 'close') {
                        // Close variations: Similar design philosophy with different implementations
                        fallbackEnhancements = [
                            `featuring hero banner with background video, services grid with icons, client testimonials carousel, contact form, and modern navigation using blue and white color scheme`,
                            `featuring sticky header with logo, full-width hero with parallax scrolling, features showcase with images, team section, blog preview, and footer using professional blue palette`,
                            `featuring navigation bar with search, hero section with split layout, service cards with hover effects, pricing table, customer reviews, and contact section using modern blue gradients`,
                            `featuring hamburger menu design, hero carousel with multiple slides, feature highlights with icons, testimonial grid layout, FAQ accordion, and contact form using clean blue theme`,
                            `featuring clean header layout, hero with background patterns, services section with detailed descriptions, client logos showcase, newsletter signup, and social media links using professional styling`
                        ];
                    } else {
                        // Unique variations: Completely different design philosophies and aesthetics
                        fallbackEnhancements = [
                            `featuring bold minimalist design with stark white background, geometric layouts, interactive elements, avant-garde typography, and monochromatic color scheme with strategic accent colors`,
                            `featuring dark mode aesthetic with neon purple accents, full-screen video backgrounds, floating navigation, immersive scrolling effects, and futuristic UI components`,
                            `featuring vintage-inspired design with ornate decorative elements, handwritten fonts, sepia-toned imagery, classic layout patterns, and warm earth tone color palette`,
                            `featuring artistic magazine-style layout with asymmetrical grid system, bold typography mixing, creative image overlays, and vibrant rainbow color scheme`,
                            `featuring corporate executive design with premium gold accents, sophisticated layouts, elegant animations, high-end photography, and luxurious dark theme with metallic elements`
                        ];
                    }
                    
                    const fallback = fallbackEnhancements[fallbackIndex] || fallbackEnhancements[0];
                    guaranteedVariations.push(`${basePrompt} - Create a ${variationsType === 'close' ? 'professional' : 'distinctive'} website ${fallback}`);
                }

                const finalVariations = guaranteedVariations.slice(0, count);
                
                console.log('✅ GUARANTEED variations generated:', finalVariations);
                console.log(`🎯 SUCCESS: ${finalVariations.length}/${count} variations, ALL contain original prompt`);
                
                // Verify all variations contain the original prompt
                const verification = finalVariations.every(v => v.includes(mainPrompt));
                console.log(`🔍 Verification: All variations contain original prompt: ${verification}`);
                
                if (!verification) {
                    console.error('❌ CRITICAL: Some variations do not contain original prompt!');
                }

                return finalVariations;
                
            } catch (error) {
                console.error('❌ Enhancement generation failed, using fallback variations');
                
                // Emergency fallback: create variations manually
                const emergencyVariations = [];
                const emergencyBasePrompt = promptModifier ? `${mainPrompt} ${promptModifier}` : mainPrompt;
                for (let i = 0; i < count; i++) {
                    emergencyVariations.push(`${emergencyBasePrompt} - Create a comprehensive modern website featuring detailed sections, professional design, and responsive layout with modern UI components and smooth user experience`);
                }
                return emergencyVariations;
            }
        }

        async function generateHtmlDesign(prompt, apiKey, model, creativityLevel = 5) {
            try {
                // Calculate temperature for design generation based on creativity level
                const designTemperature = Math.min(1.0, Math.max(0.3, (creativityLevel - 1) * 0.08 + 0.4));
                
                if (debugMode) {
                    console.log('🎨 Generating HTML design:', { prompt, model, designTemperature });
                }

                // Enhanced system prompt to ensure adherence to user prompt
                const enhancedSystemPrompt = `${SYSTEM_PROMPT_2}

🚨 CRITICAL REQUIREMENTS:
1. STRICTLY follow the provided prompt specifications
2. NEVER ignore or deviate from the core concept in the prompt
3. If the prompt specifies a particular industry, purpose, or target audience, MAINTAIN it exactly
4. Every design element must serve the purpose specified in the prompt
5. The final HTML must directly address the requirements mentioned in the prompt

⚠️ VALIDATION CHECK: Before generating HTML, ask yourself:
- Does this design serve the exact purpose specified in the prompt?
- Have I included all the sections and features mentioned?
- Does the visual design match the industry and target audience specified?
- Am I solving the specific problem mentioned in the prompt?

If any answer is NO, revise the design to strictly match the prompt requirements.`;
                
                const messages = [
                    {
                        role: "system",
                        content: enhancedSystemPrompt
                    },
                    {
                        role: "user",
                        content: `CRITICAL: Create HTML that EXACTLY matches this specification:

${prompt}

MANDATORY VERIFICATION:
- Identify the core concept from the prompt above
- Ensure every design element serves this specific purpose  
- Include all sections and features mentioned in the prompt
- Use appropriate visual design for the specified industry/audience
- The final website must directly address the requirements in the prompt

Generate the complete HTML now:`
                    }
                ];

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Bulk Design Generator'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        temperature: designTemperature,
                        max_tokens: 12000,
                        top_p: 0.95
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API request failed with status ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                const rawHtml = data.choices[0].message.content;
                
                if (debugMode) {
                    console.log('✅ HTML generated successfully, length:', rawHtml.length);
                }

                return extractHtmlFromResponse(rawHtml);
                
            } catch (error) {
                console.error('❌ HTML generation failed:', error);
                throw error;
            }
        }



        function extractHtmlFromResponse(response) {
            // 1. Try to extract from code block first
            const codeBlockMatch = response.match(/```(?:html)?\s*([\s\S]*?)```/i);
            if (codeBlockMatch) {
                // Remove any leading text before <html or <!DOCTYPE
                const htmlStart = codeBlockMatch[1].search(/<html|<!DOCTYPE/i);
                if (htmlStart !== -1) {
                    return codeBlockMatch[1].slice(htmlStart).trim();
                }
                return codeBlockMatch[1].trim();
            }
            // 2. If no code block, find the first <html or <!DOCTYPE
            const htmlStart = response.search(/<html|<!DOCTYPE/i);
            if (htmlStart !== -1) {
                return response.slice(htmlStart).trim();
            }
            // 3. Fallback: return the whole response
            return response.trim();
        }

        // Multi-Model Functions
        function toggleMultiModel() {
            isMultiModel = multiModelCheckbox.checked;
            
            if (isMultiModel) {
                modelSelectionContainer.classList.add('hidden');
                multiModelContainer.classList.remove('hidden');
                populateMultiModelList();
            } else {
                modelSelectionContainer.classList.remove('hidden');
                multiModelContainer.classList.add('hidden');
                selectedModels = [];
            }
        }

        function populateMultiModelList() {
            if (!multiModelList) return;
            
            const models = [
                // DeepSeek Models (Free)
                { value: "deepseek/deepseek-v3-0324:free", label: "DeepSeek V3 0324 (Mar 2025) - 685B params - 164K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-r1-zero:free", label: "DeepSeek R1 Zero (Jan 2025) - 671B params - 164K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-r1-distill-qwen-32b:free", label: "DeepSeek R1 Distill Qwen 32B (Feb 2025) - 32B params - 16K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-r1-distill-qwen-14b:free", label: "DeepSeek R1 Distill Qwen 14B (Feb 2025) - 14B params - 64K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-r1-distill-llama-70b:free", label: "DeepSeek R1 Distill Llama 70B (Feb 2025) - 70B params - 8K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-r1:free", label: "DeepSeek R1 (Jan 2025) - 671B params - 164K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-v3:free", label: "DeepSeek V3 (Dec 2024) - 685B params - 164K ctx", group: "DeepSeek (Free)" },
                { value: "deepseek/deepseek-chat-v3-0324:free", label: "DeepSeek Chat V3 0324 (Mar 2025) - 685B params - 128K ctx", group: "DeepSeek (Free)" },
                
                // Google Models (Free)
                { value: "google/gemini-2.5-pro-exp-03-25:free", label: "Gemini 2.5 Pro Experimental (Mar 2025) - 1M ctx", group: "Google (Free)" },
                { value: "google/gemma-3-27b-it:free", label: "Gemma 3 27B (Mar 2025) - 27B params - 131K ctx", group: "Google (Free)" },
                { value: "google/gemini-2.0-flash-exp:free", label: "Gemini 2.0 Flash Experimental (Dec 2024) - 1M ctx", group: "Google (Free)" },
                { value: "google/learnlm-1.5-pro-experimental", label: "LearnLM 1.5 Pro Experimental (Nov 2024) - 40K ctx", group: "Google (Free)" },
                
                // Qwen Models (Free)
                { value: "qwen/qwen3-30b-a3b:free", label: "Qwen3-30B-A3B (Apr 2025) - 30B params - 128K ctx", group: "Qwen (Free)" },
                { value: "qwen/qwen3-235b-a22b:free", label: "Qwen3-235B-A22B (Apr 2025) - 235B params - 128K ctx", group: "Qwen (Free)" },
                { value: "qwen/qwen-2.5-coder-32b-instruct:free", label: "Qwen 2.5 Coder 32B Instruct (Nov 2024) - 32B params - 131K ctx", group: "Qwen (Free)" },
                { value: "qwen/qwen-2.5-72b-instruct:free", label: "Qwen 2.5 72B Instruct (Sep 2024) - 72B params - 131K ctx", group: "Qwen (Free)" },
                
                // Meta Models (Free)
                { value: "meta-llama/llama-3.2-90b-vision-instruct:free", label: "Llama 3.2 90B Vision Instruct (Sep 2024) - 90B params - 131K ctx", group: "Meta (Free)" },
                { value: "meta-llama/llama-3.2-11b-vision-instruct:free", label: "Llama 3.2 11B Vision Instruct (Sep 2024) - 11B params - 131K ctx", group: "Meta (Free)" },
                { value: "meta-llama/llama-3.2-3b-instruct:free", label: "Llama 3.2 3B Instruct (Sep 2024) - 3B params - 131K ctx", group: "Meta (Free)" },
                { value: "meta-llama/llama-3.2-1b-instruct:free", label: "Llama 3.2 1B Instruct (Sep 2024) - 1B params - 131K ctx", group: "Meta (Free)" },
                { value: "meta-llama/llama-3.1-8b-instruct:free", label: "Llama 3.1 8B Instruct (Jul 2024) - 8B params - 131K ctx", group: "Meta (Free)" },
                
                // Microsoft Models (Free)
                { value: "microsoft/phi-3-mini-128k-instruct:free", label: "Phi-3 Mini 128K Instruct (Apr 2024) - 3.8B params - 128K ctx", group: "Microsoft (Free)" },
                { value: "microsoft/phi-3-medium-128k-instruct:free", label: "Phi-3 Medium 128K Instruct (Apr 2024) - 14B params - 128K ctx", group: "Microsoft (Free)" },
                
                // Mistral Models (Free)
                { value: "mistralai/mistral-7b-instruct:free", label: "Mistral 7B Instruct v0.1 (Sep 2023) - 7B params - 32K ctx", group: "Mistral (Free)" },
                { value: "mistralai/codestral-mamba:free", label: "Codestral Mamba (Jul 2024) - 7B params - 256K ctx", group: "Mistral (Free)" },
                
                // Hugging Face Models (Free)
                { value: "huggingfaceh4/zephyr-7b-beta:free", label: "Zephyr 7B Beta (Oct 2023) - 7B params - 32K ctx", group: "Hugging Face (Free)" },
                
                // OpenChat Models (Free)
                { value: "openchat/openchat-7b:free", label: "OpenChat 7B (Jul 2023) - 7B params - 8K ctx", group: "OpenChat (Free)" },
                
                // Gryphe Models (Free)
                { value: "gryphe/mythomist-7b:free", label: "MythoMist 7B (Jan 2024) - 7B params - 32K ctx", group: "Gryphe (Free)" },
                
                // Undi95 Models (Free)
                { value: "undi95/toppy-m-7b:free", label: "Toppy M 7B (Dec 2023) - 7B params - 4K ctx", group: "Undi95 (Free)" }
            ];

            let currentGroup = '';
            let html = '';
            
            models.forEach(model => {
                if (model.group !== currentGroup) {
                    if (currentGroup !== '') html += '</div>';
                    html += `<div class="mb-3"><h4 class="text-xs font-semibold text-white text-opacity-70 mb-2">${model.group}</h4>`;
                    currentGroup = model.group;
                }
                
                html += `
                    <label class="flex items-start gap-2 cursor-pointer p-2 rounded hover:bg-white hover:bg-opacity-5 transition-colors">
                        <input type="checkbox" value="${model.value}" class="aurora-checkbox mt-0.5 model-checkbox" ${selectedModels.includes(model.value) ? 'checked' : ''}>
                        <span class="text-xs text-white text-opacity-80 leading-tight">${model.label}</span>
                    </label>
                `;
            });
            
            if (currentGroup !== '') html += '</div>';
            
            multiModelList.innerHTML = html;
            lucide.createIcons();
            
            // Add event listeners to checkboxes
            document.querySelectorAll('.model-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedModels);
            });
            
            updateSelectedModelCount();
        }

        function updateSelectedModels() {
            const checkboxes = document.querySelectorAll('.model-checkbox:checked');
            selectedModels = Array.from(checkboxes).map(cb => cb.value);
            
            // Limit to 10 models
            if (selectedModels.length > 10) {
                const lastCheckbox = document.querySelector('.model-checkbox:checked:last-of-type');
                if (lastCheckbox) {
                    lastCheckbox.checked = false;
                    selectedModels.pop();
                }
                showToast('Maximum 10 models allowed', 'warning');
            }
            
            updateSelectedModelCount();
        }

        function updateSelectedModelCount() {
            if (selectedModelCount) {
                selectedModelCount.textContent = selectedModels.length;
            }
        }

        function getSelectedModels() {
            if (isMultiModel) {
                return selectedModels.length > 0 ? selectedModels : [modalAiModel.value];
            }
            return [modalAiModel.value];
        }
    </script>
</body>
</html>